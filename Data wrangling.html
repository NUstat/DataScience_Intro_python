<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction to Data Science with Python - 8&nbsp; Data wrangling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Data aggregation.html" rel="next">
<link href="./Data cleaning and preparation.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Reading data.html">Exploratory data analysis</a></li><li class="breadcrumb-item"><a href="./Data wrangling.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data wrangling</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./NU_Stat_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Data Science with Python</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Quick overview: Python programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction to Python and Jupyter Notebooks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Python and Jupyter Notebooks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_structures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data structures</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Exploratory data analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Reading data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Reading data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./NumPy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">NumPy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Pandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Pandas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data cleaning and preparation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data cleaning and preparation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data wrangling.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data wrangling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data aggregation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data aggregation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./student_solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Alternative solutions by students</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Assignment A.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Assignment A</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Assignment B.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Assignment B</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Assignment C.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Assignment C</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Assignment D.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Assignment D</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Assignment E.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Assignment E</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Datasets &amp; Templates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#hierarchical-indexing" id="toc-hierarchical-indexing" class="nav-link active" data-scroll-target="#hierarchical-indexing"><span class="header-section-number">8.1</span> Hierarchical indexing</a>
  <ul>
  <li><a href="#hierarchical-indexing-in-pandas-series" id="toc-hierarchical-indexing-in-pandas-series" class="nav-link" data-scroll-target="#hierarchical-indexing-in-pandas-series"><span class="header-section-number">8.1.1</span> Hierarchical indexing in Pandas Series</a></li>
  <li><a href="#hierarchical-indexing-in-pandas-dataframe" id="toc-hierarchical-indexing-in-pandas-dataframe" class="nav-link" data-scroll-target="#hierarchical-indexing-in-pandas-dataframe"><span class="header-section-number">8.1.2</span> Hierarchical indexing in Pandas DataFrame</a>
  <ul class="collapse">
  <li><a href="#get_level_values" id="toc-get_level_values" class="nav-link" data-scroll-target="#get_level_values"><span class="header-section-number">8.1.2.1</span> <code>get_level_values()</code></a></li>
  </ul></li>
  <li><a href="#subsetting-data" id="toc-subsetting-data" class="nav-link" data-scroll-target="#subsetting-data"><span class="header-section-number">8.1.3</span> Subsetting data</a></li>
  <li><a href="#practice-exercise-1" id="toc-practice-exercise-1" class="nav-link" data-scroll-target="#practice-exercise-1"><span class="header-section-number">8.1.4</span> Practice exercise 1</a>
  <ul class="collapse">
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="header-section-number">8.1.4.1</span> </a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"><span class="header-section-number">8.1.4.2</span> </a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"><span class="header-section-number">8.1.4.3</span> </a></li>
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3"><span class="header-section-number">8.1.4.4</span> </a></li>
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4"><span class="header-section-number">8.1.4.5</span> </a></li>
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5"><span class="header-section-number">8.1.4.6</span> </a></li>
  </ul></li>
  <li><a href="#practice-exercise-2" id="toc-practice-exercise-2" class="nav-link" data-scroll-target="#practice-exercise-2"><span class="header-section-number">8.1.5</span> Practice exercise 2</a>
  <ul class="collapse">
  <li><a href="#section-6" id="toc-section-6" class="nav-link" data-scroll-target="#section-6"><span class="header-section-number">8.1.5.1</span> </a></li>
  <li><a href="#section-7" id="toc-section-7" class="nav-link" data-scroll-target="#section-7"><span class="header-section-number">8.1.5.2</span> </a></li>
  </ul></li>
  <li><a href="#practice-exercise-3" id="toc-practice-exercise-3" class="nav-link" data-scroll-target="#practice-exercise-3"><span class="header-section-number">8.1.6</span> Practice exercise 3</a></li>
  <li><a href="#reshaping-data" id="toc-reshaping-data" class="nav-link" data-scroll-target="#reshaping-data"><span class="header-section-number">8.1.7</span> Reshaping data</a>
  <ul class="collapse">
  <li><a href="#unstack-pandas-series-method" id="toc-unstack-pandas-series-method" class="nav-link" data-scroll-target="#unstack-pandas-series-method"><span class="header-section-number">8.1.7.1</span> <code>unstack()</code> (Pandas Series method)</a></li>
  <li><a href="#unstack-pandas-dataframe-method" id="toc-unstack-pandas-dataframe-method" class="nav-link" data-scroll-target="#unstack-pandas-dataframe-method"><span class="header-section-number">8.1.7.2</span> <code>unstack()</code> (Pandas DataFrame method)</a></li>
  <li><a href="#stack" id="toc-stack" class="nav-link" data-scroll-target="#stack"><span class="header-section-number">8.1.7.3</span> <code>stack()</code></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#merging-data" id="toc-merging-data" class="nav-link" data-scroll-target="#merging-data"><span class="header-section-number">8.2</span> Merging data</a>
  <ul>
  <li><a href="#join-types" id="toc-join-types" class="nav-link" data-scroll-target="#join-types"><span class="header-section-number">8.2.1</span> Join types</a>
  <ul class="collapse">
  <li><a href="#one-to-one-join" id="toc-one-to-one-join" class="nav-link" data-scroll-target="#one-to-one-join"><span class="header-section-number">8.2.1.1</span> One-to-one join</a></li>
  <li><a href="#many-to-one-join" id="toc-many-to-one-join" class="nav-link" data-scroll-target="#many-to-one-join"><span class="header-section-number">8.2.1.2</span> Many-to-one join</a></li>
  <li><a href="#one-to-many-join" id="toc-one-to-many-join" class="nav-link" data-scroll-target="#one-to-many-join"><span class="header-section-number">8.2.1.3</span> One-to-many join</a></li>
  <li><a href="#many-to-many-join" id="toc-many-to-many-join" class="nav-link" data-scroll-target="#many-to-many-join"><span class="header-section-number">8.2.1.4</span> Many-to-many join</a></li>
  </ul></li>
  <li><a href="#join-types-with-how-argument" id="toc-join-types-with-how-argument" class="nav-link" data-scroll-target="#join-types-with-how-argument"><span class="header-section-number">8.2.2</span> Join types with <code>how</code> argument</a>
  <ul class="collapse">
  <li><a href="#inner-join" id="toc-inner-join" class="nav-link" data-scroll-target="#inner-join"><span class="header-section-number">8.2.2.1</span> inner join</a></li>
  <li><a href="#left-join" id="toc-left-join" class="nav-link" data-scroll-target="#left-join"><span class="header-section-number">8.2.2.2</span> left join</a></li>
  <li><a href="#right-join" id="toc-right-join" class="nav-link" data-scroll-target="#right-join"><span class="header-section-number">8.2.2.3</span> right join</a></li>
  <li><a href="#outer-join" id="toc-outer-join" class="nav-link" data-scroll-target="#outer-join"><span class="header-section-number">8.2.2.4</span> outer join</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#concatenating-datasets" id="toc-concatenating-datasets" class="nav-link" data-scroll-target="#concatenating-datasets"><span class="header-section-number">8.3</span> Concatenating datasets</a>
  <ul>
  <li><a href="#practice-exercise-4" id="toc-practice-exercise-4" class="nav-link" data-scroll-target="#practice-exercise-4"><span class="header-section-number">8.3.1</span> Practice exercise 4</a></li>
  </ul></li>
  <li><a href="#reshaping-data-1" id="toc-reshaping-data-1" class="nav-link" data-scroll-target="#reshaping-data-1"><span class="header-section-number">8.4</span> Reshaping data</a>
  <ul>
  <li><a href="#pivoting-long-to-wide-format" id="toc-pivoting-long-to-wide-format" class="nav-link" data-scroll-target="#pivoting-long-to-wide-format"><span class="header-section-number">8.4.1</span> Pivoting “long” to “wide” format</a>
  <ul class="collapse">
  <li><a href="#pivot" id="toc-pivot" class="nav-link" data-scroll-target="#pivot"><code>pivot()</code></a></li>
  <li><a href="#pivoting-a-single-column" id="toc-pivoting-a-single-column" class="nav-link" data-scroll-target="#pivoting-a-single-column"><span class="header-section-number">8.4.1.1</span> Pivoting a single column</a></li>
  <li><a href="#pivoting-multiple-columns" id="toc-pivoting-multiple-columns" class="nav-link" data-scroll-target="#pivoting-multiple-columns"><span class="header-section-number">8.4.1.2</span> Pivoting multiple columns</a></li>
  </ul></li>
  <li><a href="#melting-wide-to-long-format" id="toc-melting-wide-to-long-format" class="nav-link" data-scroll-target="#melting-wide-to-long-format"><span class="header-section-number">8.4.2</span> Melting “wide” to “long” format</a>
  <ul class="collapse">
  <li><a href="#melt" id="toc-melt" class="nav-link" data-scroll-target="#melt"><code>melt()</code></a></li>
  <li><a href="#melting-columns-with-a-single-type-of-value" id="toc-melting-columns-with-a-single-type-of-value" class="nav-link" data-scroll-target="#melting-columns-with-a-single-type-of-value"><span class="header-section-number">8.4.2.1</span> Melting columns with a single type of value</a></li>
  <li><a href="#melting-columns-with-multiple-types-of-values" id="toc-melting-columns-with-multiple-types-of-values" class="nav-link" data-scroll-target="#melting-columns-with-multiple-types-of-values"><span class="header-section-number">8.4.2.2</span> Melting columns with multiple types of values</a></li>
  </ul></li>
  <li><a href="#practice-exercise-5" id="toc-practice-exercise-5" class="nav-link" data-scroll-target="#practice-exercise-5"><span class="header-section-number">8.4.3</span> Practice exercise 5</a>
  <ul class="collapse">
  <li><a href="#section-8" id="toc-section-8" class="nav-link" data-scroll-target="#section-8"><span class="header-section-number">8.4.3.1</span> </a></li>
  <li><a href="#section-9" id="toc-section-9" class="nav-link" data-scroll-target="#section-9"><span class="header-section-number">8.4.3.2</span> </a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data wrangling</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Data wrangling refers to combining, transforming, and re-arranging data to make it suitable for further analysis. We’ll use Pandas for all data wrangling operations.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="hierarchical-indexing" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="hierarchical-indexing"><span class="header-section-number">8.1</span> Hierarchical indexing</h2>
<p>Until now we have seen only a single level of indexing in the rows and columns of a Pandas DataFrame. Hierarchical indexing refers to having multiple index levels on an axis (row / column) of a Pandas DataFrame. It helps us to work with a higher dimensional data in a lower dimensional form.</p>
<section id="hierarchical-indexing-in-pandas-series" class="level3" data-number="8.1.1">
<h3 data-number="8.1.1" class="anchored" data-anchor-id="hierarchical-indexing-in-pandas-series"><span class="header-section-number">8.1.1</span> Hierarchical indexing in Pandas Series</h3>
<p>Let us define Pandas Series as we defined in Chapter 5:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Defining a Pandas Series</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>series_example <span class="op">=</span> pd.Series([<span class="st">'these'</span>,<span class="st">'are'</span>,<span class="st">'english'</span>,<span class="st">'words'</span>,<span class="st">'estas'</span>,<span class="st">'son'</span>,<span class="st">'palabras'</span>,<span class="st">'en'</span>,<span class="st">'español'</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'ce'</span>,<span class="st">'sont'</span>,<span class="st">'des'</span>,<span class="st">'françai'</span>,<span class="st">'mots'</span>])</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>series_example</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>0        these
1          are
2      english
3        words
4        estas
5          son
6     palabras
7           en
8      español
9           ce
10        sont
11         des
12     françai
13        mots
dtype: object</code></pre>
</div>
</div>
<p>Let us use the attribute <code>nlevels</code> to find the number of levels of the row indices of this Series:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>series_example.index.nlevels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>1</code></pre>
</div>
</div>
<p>The Series <code>series_example</code> has only one level of row indices.</p>
<p>Let us introduce another level of row indices while defining the Series:</p>
<div class="cell" data-execution_count="377">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Defining a Pandas Series with multiple levels of row indices</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>series_example <span class="op">=</span> pd.Series([<span class="st">'these'</span>,<span class="st">'are'</span>,<span class="st">'english'</span>,<span class="st">'words'</span>,<span class="st">'estas'</span>,<span class="st">'son'</span>,<span class="st">'palabras'</span>,<span class="st">'en'</span>,<span class="st">'español'</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                           <span class="st">'ce'</span>,<span class="st">'sont'</span>,<span class="st">'des'</span>,<span class="st">'françai'</span>,<span class="st">'mots'</span>], </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                          index<span class="op">=</span>[[<span class="st">'English'</span>]<span class="op">*</span><span class="dv">4</span><span class="op">+</span>[<span class="st">'Spanish'</span>]<span class="op">*</span><span class="dv">5</span><span class="op">+</span>[<span class="st">'French'</span>]<span class="op">*</span><span class="dv">5</span>,<span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">5</span>))<span class="op">+</span><span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">6</span>))<span class="op">*</span><span class="dv">2</span>])</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>series_example</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="377">
<pre><code>English  1       these
         2         are
         3     english
         4       words
Spanish  1       estas
         2         son
         3    palabras
         4          en
         5     español
French   1          ce
         2        sont
         3         des
         4     françai
         5        mots
dtype: object</code></pre>
</div>
</div>
<p>In the above Series, there are two levels of row indices:</p>
<div class="cell" data-execution_count="378">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>series_example.index.nlevels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="378">
<pre><code>2</code></pre>
</div>
</div>
</section>
<section id="hierarchical-indexing-in-pandas-dataframe" class="level3" data-number="8.1.2">
<h3 data-number="8.1.2" class="anchored" data-anchor-id="hierarchical-indexing-in-pandas-dataframe"><span class="header-section-number">8.1.2</span> Hierarchical indexing in Pandas DataFrame</h3>
<p>In a Pandas DataFrame, both the rows and the columns can have hierarchical indexing. For example, consider the DataFrame below:</p>
<div class="cell" data-execution_count="416">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span>np.array([[<span class="dv">771517</span>,<span class="dv">2697000</span>,<span class="dv">815201</span>,<span class="dv">3849000</span>],[<span class="fl">4.2</span>,<span class="fl">5.6</span>,<span class="fl">2.8</span>,<span class="fl">4.6</span>],</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>             [<span class="fl">7.8</span>,<span class="fl">234.5</span>,<span class="fl">46.9</span>,<span class="dv">502</span>],[<span class="dv">6749</span>, <span class="dv">597</span>, <span class="dv">52</span>, <span class="dv">305</span>]])</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>df_example <span class="op">=</span> pd.DataFrame(data,index <span class="op">=</span> [[<span class="st">'Demographics'</span>]<span class="op">*</span><span class="dv">2</span><span class="op">+</span>[<span class="st">'Geography'</span>]<span class="op">*</span><span class="dv">2</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                                      [<span class="st">'Population'</span>,<span class="st">'Unemployment (%)'</span>,<span class="st">'Area (mile-sq)'</span>,<span class="st">'Elevation (feet)'</span>]],</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                    columns <span class="op">=</span> [[<span class="st">'Illinois'</span>]<span class="op">*</span><span class="dv">2</span><span class="op">+</span>[<span class="st">'California'</span>]<span class="op">*</span><span class="dv">2</span>,[<span class="st">'Evanston'</span>,<span class="st">'Chicago'</span>,<span class="st">'San Francisco'</span>,<span class="st">'Los Angeles'</span>]])</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>df_example</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="416">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">Illinois</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">California</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Evanston</th>
<th data-quarto-table-cell-role="th">Chicago</th>
<th data-quarto-table-cell-role="th">San Francisco</th>
<th data-quarto-table-cell-role="th">Los Angeles</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Demographics</td>
<td data-quarto-table-cell-role="th">Population</td>
<td>771517.0</td>
<td>2697000.0</td>
<td>815201.0</td>
<td>3849000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Unemployment (%)</td>
<td>4.2</td>
<td>5.6</td>
<td>2.8</td>
<td>4.6</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Geography</td>
<td data-quarto-table-cell-role="th">Area (mile-sq)</td>
<td>7.8</td>
<td>234.5</td>
<td>46.9</td>
<td>502.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Elevation (feet)</td>
<td>6749.0</td>
<td>597.0</td>
<td>52.0</td>
<td>305.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In the above DataFrame, both the rows and columns have 2 levels of indexing. The number of levels of column indices can be found using the attribute <code>nlevels</code>:</p>
<div class="cell" data-execution_count="380">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df_example.columns.nlevels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="380">
<pre><code>2</code></pre>
</div>
</div>
<p>The <code>columns</code> attribute will now have a <em>MultiIndex</em> datatype in contrast to the <em>Index</em> datatype with single level of indexing. The same holds for row indices.</p>
<div class="cell" data-execution_count="381">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(df_example.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="381">
<pre><code>pandas.core.indexes.multi.MultiIndex</code></pre>
</div>
</div>
<div class="cell" data-execution_count="382">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df_example.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="382">
<pre><code>MultiIndex([(  'Illinois',      'Evanston'),
            (  'Illinois',       'Chicago'),
            ('California', 'San Francisco'),
            ('California',   'Los Angeles')],
           )</code></pre>
</div>
</div>
<p>The hierarchical levels can have names. Let us assign names to the each level of the row and column labels:</p>
<div class="cell" data-execution_count="417">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Naming the row indices levels</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df_example.index.names<span class="op">=</span>[<span class="st">'Information type'</span>, <span class="st">'Statistic'</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Naming the column indices levels</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>df_example.columns.names<span class="op">=</span>[<span class="st">'State'</span>, <span class="st">'City'</span>]</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Viewing the DataFrame</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>df_example</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="417">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">State</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">Illinois</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">California</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">Evanston</th>
<th data-quarto-table-cell-role="th">Chicago</th>
<th data-quarto-table-cell-role="th">San Francisco</th>
<th data-quarto-table-cell-role="th">Los Angeles</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">Information type</th>
<th data-quarto-table-cell-role="th">Statistic</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Demographics</td>
<td data-quarto-table-cell-role="th">Population</td>
<td>771517.0</td>
<td>2697000.0</td>
<td>815201.0</td>
<td>3849000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Unemployment (%)</td>
<td>4.2</td>
<td>5.6</td>
<td>2.8</td>
<td>4.6</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Geography</td>
<td data-quarto-table-cell-role="th">Area (mile-sq)</td>
<td>7.8</td>
<td>234.5</td>
<td>46.9</td>
<td>502.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Elevation (feet)</td>
<td>6749.0</td>
<td>597.0</td>
<td>52.0</td>
<td>305.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Observe that the names of the row and column labels appear when we view the DataFrame.</p>
<section id="get_level_values" class="level4" data-number="8.1.2.1">
<h4 data-number="8.1.2.1" class="anchored" data-anchor-id="get_level_values"><span class="header-section-number">8.1.2.1</span> <a href="https://pandas.pydata.org/docs/reference/api/pandas.Index.get_level_values.html"><code>get_level_values()</code></a></h4>
<p>The names of the column levels can be obtained using the function <code>get_level_values()</code>. The outer-most level corresponds to the <em>level = 0</em>, and it increases as we go to the inner levels.</p>
<div class="cell" data-execution_count="384">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Column levels at level 0 (the outer level)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df_example.columns.get_level_values(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="384">
<pre><code>Index(['Illinois', 'Illinois', 'California', 'California'], dtype='object', name='State')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="385">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Column levels at level 1 (the inner level)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df_example.columns.get_level_values(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="385">
<pre><code>Index(['Evanston', 'Chicago', 'San Francisco', 'Los Angeles'], dtype='object', name='City')</code></pre>
</div>
</div>
</section>
</section>
<section id="subsetting-data" class="level3" data-number="8.1.3">
<h3 data-number="8.1.3" class="anchored" data-anchor-id="subsetting-data"><span class="header-section-number">8.1.3</span> Subsetting data</h3>
<p>We can use the indices at the outer levels to concisely subset a Series / DataFrame.</p>
<p>The first four observations of the Series <code>series_example</code> correspond to the outer row index <code>English</code>, while the last 5 rows correspond to the outer row index <code>Spanish</code>. Let us subset all the observations corresponding to the outer row index <code>English</code>:</p>
<div class="cell" data-execution_count="386">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Subsetting data by row-index</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>series_example[<span class="st">'English'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="386">
<pre><code>1      these
2        are
3    english
4      words
dtype: object</code></pre>
</div>
</div>
<p>Just like in the case of single level indices, if we wish to subset corresponding to multiple outer-level indices, we put the indices within an additional box bracket <code>[]</code>. For example, let us subset all the observations corresponding to the row-indices <code>English</code> and <code>French</code>:</p>
<div class="cell" data-execution_count="387">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Subsetting data by multiple row-indices</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>series_example[[<span class="st">'English'</span>,<span class="st">'French'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="387">
<pre><code>English  1      these
         2        are
         3    english
         4      words
French   1         ce
         2       sont
         3        des
         4    françai
         5       mots
dtype: object</code></pre>
</div>
</div>
<p>We can also subset data using the inner row index. However, we will need to put a <code>:</code> sign to indicate that the row label at the inner level is being used.</p>
<div class="cell" data-execution_count="392">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Subsetting data by row-index</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>series_example[:,<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="392">
<pre><code>English     are
Spanish     son
French     sont
dtype: object</code></pre>
</div>
</div>
<div class="cell" data-execution_count="404">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Subsetting data by multiple row-indices</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>series_example.loc[:,[<span class="dv">1</span>,<span class="dv">2</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="404">
<pre><code>English  1    these
Spanish  1    estas
French   1       ce
English  2      are
Spanish  2      son
French   2     sont
dtype: object</code></pre>
</div>
</div>
<p>As in Series, we can concisely subset rows / columns in a DataFrame based on the index at the outer levels.</p>
<div class="cell" data-execution_count="418">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df_example[<span class="st">'Illinois'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="418">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">Evanston</th>
<th data-quarto-table-cell-role="th">Chicago</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Information type</th>
<th data-quarto-table-cell-role="th">Statistic</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Demographics</td>
<td data-quarto-table-cell-role="th">Population</td>
<td>771517.0</td>
<td>2697000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Unemployment (%)</td>
<td>4.2</td>
<td>5.6</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Geography</td>
<td data-quarto-table-cell-role="th">Area (mile-sq)</td>
<td>7.8</td>
<td>234.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Elevation (feet)</td>
<td>6749.0</td>
<td>597.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Note that the dataype of each column name is a tuple. For example, let us find the datatype of the <span class="math inline">\(1^{st}\)</span> column name:</p>
<div class="cell" data-execution_count="223">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#First column name</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>df_example.columns[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="223">
<pre><code>('Illinois', 'Evanston')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="220">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Datatype of first column name</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(df_example.columns[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="220">
<pre><code>tuple</code></pre>
</div>
</div>
<p>Thus columns at the inner levels can be accessed by specifying the name as a tuple. For example, let us subset the column <code>Evanston</code>:</p>
<div class="cell" data-execution_count="419">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Subsetting the column 'Evanston'</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>df_example[(<span class="st">'Illinois'</span>,<span class="st">'Evanston'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="419">
<pre><code>Information type  Statistic       
Demographics      Population          771517.0
                  Unemployment (%)         4.2
Geography         Area (mile-sq)           7.8
                  Elevation (feet)      6749.0
Name: (Illinois, Evanston), dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="420">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Subsetting the columns 'Evanston' and 'Chicago' of the outer column level 'Illinois'</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>df_example.loc[:,(<span class="st">'Illinois'</span>,[<span class="st">'Evanston'</span>,<span class="st">'Chicago'</span>])]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="420">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">State</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">Illinois</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">Evanston</th>
<th data-quarto-table-cell-role="th">Chicago</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">Information type</th>
<th data-quarto-table-cell-role="th">Statistic</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Demographics</td>
<td data-quarto-table-cell-role="th">Population</td>
<td>771517.0</td>
<td>2697000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Unemployment (%)</td>
<td>4.2</td>
<td>5.6</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Geography</td>
<td data-quarto-table-cell-role="th">Area (mile-sq)</td>
<td>7.8</td>
<td>234.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Elevation (feet)</td>
<td>6749.0</td>
<td>597.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="practice-exercise-1" class="level3" data-number="8.1.4">
<h3 data-number="8.1.4" class="anchored" data-anchor-id="practice-exercise-1"><span class="header-section-number">8.1.4</span> Practice exercise 1</h3>
<p>Read the table consisting of GDP per capita of countries from the webpage: https://en.wikipedia.org/wiki/List_of_countries_by_GDP_(nominal)_per_capita .</p>
<p>To only read the relevant table, read the tables that contain the word <em>‘Country’</em>.</p>
<section id="section" class="level4" data-number="8.1.4.1">
<h4 data-number="8.1.4.1" class="anchored" data-anchor-id="section"><span class="header-section-number">8.1.4.1</span> </h4>
<p>How many levels of indexing are there in the rows and columns?</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> pd.read_html(<span class="st">'https://en.wikipedia.org/wiki/List_of_countries_by_GDP_(nominal)_per_capita'</span>, match <span class="op">=</span> <span class="st">'Country'</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>gdp_per_capita <span class="op">=</span> dfs[<span class="dv">0</span>]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>gdp_per_capita.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Country/Territory</th>
<th data-quarto-table-cell-role="th">UN Region</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">IMF[4]</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">World Bank[5]</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">United Nations[6]</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Country/Territory</th>
<th data-quarto-table-cell-role="th">UN Region</th>
<th data-quarto-table-cell-role="th">Estimate</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Estimate</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">Estimate</th>
<th data-quarto-table-cell-role="th">Year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Liechtenstein *</td>
<td>Europe</td>
<td>—</td>
<td>—</td>
<td>169049</td>
<td>2019</td>
<td>180227</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Monaco *</td>
<td>Europe</td>
<td>—</td>
<td>—</td>
<td>173688</td>
<td>2020</td>
<td>173696</td>
<td>2020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Luxembourg *</td>
<td>Europe</td>
<td>127673</td>
<td>2022</td>
<td>135683</td>
<td>2021</td>
<td>117182</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Bermuda *</td>
<td>Americas</td>
<td>—</td>
<td>—</td>
<td>110870</td>
<td>2021</td>
<td>123945</td>
<td>2020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Ireland *</td>
<td>Europe</td>
<td>102217</td>
<td>2022</td>
<td>99152</td>
<td>2021</td>
<td>86251</td>
<td>2020</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Just by looking at the DataFrame, it seems as if there are two levels of indexing for columns and one level of indexing for rows. However, let us confirm it with the <code>nlevels</code> attribute.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>gdp_per_capita.columns.nlevels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>2</code></pre>
</div>
</div>
<p>Yes, there are 2 levels of indexing for columns.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>gdp_per_capita.index.nlevels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>1</code></pre>
</div>
</div>
<p>There is one level of indexing for rows.</p>
</section>
<section id="section-1" class="level4" data-number="8.1.4.2">
<h4 data-number="8.1.4.2" class="anchored" data-anchor-id="section-1"><span class="header-section-number">8.1.4.2</span> </h4>
<p>Subset a DataFrame that selects the country, and the United Nations’ estimates of GDP per capita with the corresponding year.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>gdp_per_capita.loc[:,[<span class="st">'Country/Territory'</span>,<span class="st">'United Nations[6]'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Country/Territory</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">United Nations[6]</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Country/Territory</th>
<th data-quarto-table-cell-role="th">Estimate</th>
<th data-quarto-table-cell-role="th">Year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Liechtenstein *</td>
<td>180227</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Monaco *</td>
<td>173696</td>
<td>2020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Luxembourg *</td>
<td>117182</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Bermuda *</td>
<td>123945</td>
<td>2020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Ireland *</td>
<td>86251</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">217</td>
<td>Madagascar *</td>
<td>470</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">218</td>
<td>Central African Republic *</td>
<td>481</td>
<td>2020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">219</td>
<td>Sierra Leone *</td>
<td>475</td>
<td>2020</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">220</td>
<td>South Sudan *</td>
<td>1421</td>
<td>2020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">221</td>
<td>Burundi *</td>
<td>286</td>
<td>2020</td>
</tr>
</tbody>
</table>

<p>222 rows × 3 columns</p>
</div>
</div>
</div>
</section>
<section id="section-2" class="level4" data-number="8.1.4.3">
<h4 data-number="8.1.4.3" class="anchored" data-anchor-id="section-2"><span class="header-section-number">8.1.4.3</span> </h4>
<p>Subset a DataFrame that selects only the World Bank and United Nations’ estimates of GDP per capita without the corresponding year or country.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>gdp_per_capita.loc[:,([<span class="st">'World Bank[5]'</span>,<span class="st">'United Nations[6]'</span>],<span class="st">'Estimate'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">World Bank[5]</th>
<th data-quarto-table-cell-role="th">United Nations[6]</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Estimate</th>
<th data-quarto-table-cell-role="th">Estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>169049</td>
<td>180227</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>173688</td>
<td>173696</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>135683</td>
<td>117182</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>110870</td>
<td>123945</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>99152</td>
<td>86251</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">217</td>
<td>515</td>
<td>470</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">218</td>
<td>512</td>
<td>481</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">219</td>
<td>516</td>
<td>475</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">220</td>
<td>1120</td>
<td>1421</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">221</td>
<td>237</td>
<td>286</td>
</tr>
</tbody>
</table>

<p>222 rows × 2 columns</p>
</div>
</div>
</div>
</section>
<section id="section-3" class="level4" data-number="8.1.4.4">
<h4 data-number="8.1.4.4" class="anchored" data-anchor-id="section-3"><span class="header-section-number">8.1.4.4</span> </h4>
<p>Subset a DataFrame that selects the country and only the World Bank and United Nations’ estimates of GDP per capita without the corresponding year or country.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>gdp_per_capita.loc[:,[(<span class="st">'Country/Territory'</span>,<span class="st">'Country/Territory'</span>),(<span class="st">'United Nations[6]'</span>,<span class="st">'Estimate'</span>),(<span class="st">'World Bank[5]'</span>,<span class="st">'Estimate'</span>)]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Country/Territory</th>
<th data-quarto-table-cell-role="th">United Nations[6]</th>
<th data-quarto-table-cell-role="th">World Bank[5]</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Country/Territory</th>
<th data-quarto-table-cell-role="th">Estimate</th>
<th data-quarto-table-cell-role="th">Estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Liechtenstein *</td>
<td>180227</td>
<td>169049</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Monaco *</td>
<td>173696</td>
<td>173688</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Luxembourg *</td>
<td>117182</td>
<td>135683</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Bermuda *</td>
<td>123945</td>
<td>110870</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Ireland *</td>
<td>86251</td>
<td>99152</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">217</td>
<td>Madagascar *</td>
<td>470</td>
<td>515</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">218</td>
<td>Central African Republic *</td>
<td>481</td>
<td>512</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">219</td>
<td>Sierra Leone *</td>
<td>475</td>
<td>516</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">220</td>
<td>South Sudan *</td>
<td>1421</td>
<td>1120</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">221</td>
<td>Burundi *</td>
<td>286</td>
<td>237</td>
</tr>
</tbody>
</table>

<p>222 rows × 3 columns</p>
</div>
</div>
</div>
</section>
<section id="section-4" class="level4" data-number="8.1.4.5">
<h4 data-number="8.1.4.5" class="anchored" data-anchor-id="section-4"><span class="header-section-number">8.1.4.5</span> </h4>
<p>Drop all columns consisting of years. Use the <code>level</code> argument of the <code>drop()</code> method.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>gdp_per_capita <span class="op">=</span> gdp_per_capita.drop(columns<span class="op">=</span><span class="st">'Year'</span>,level<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>gdp_per_capita</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Country/Territory</th>
<th data-quarto-table-cell-role="th">UN Region</th>
<th data-quarto-table-cell-role="th">IMF[4]</th>
<th data-quarto-table-cell-role="th">World Bank[5]</th>
<th data-quarto-table-cell-role="th">United Nations[6]</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Country/Territory</th>
<th data-quarto-table-cell-role="th">UN Region</th>
<th data-quarto-table-cell-role="th">Estimate</th>
<th data-quarto-table-cell-role="th">Estimate</th>
<th data-quarto-table-cell-role="th">Estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Liechtenstein *</td>
<td>Europe</td>
<td>—</td>
<td>169049</td>
<td>180227</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Monaco *</td>
<td>Europe</td>
<td>—</td>
<td>173688</td>
<td>173696</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Luxembourg *</td>
<td>Europe</td>
<td>127673</td>
<td>135683</td>
<td>117182</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Bermuda *</td>
<td>Americas</td>
<td>—</td>
<td>110870</td>
<td>123945</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Ireland *</td>
<td>Europe</td>
<td>102217</td>
<td>99152</td>
<td>86251</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">217</td>
<td>Madagascar *</td>
<td>Africa</td>
<td>522</td>
<td>515</td>
<td>470</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">218</td>
<td>Central African Republic *</td>
<td>Africa</td>
<td>496</td>
<td>512</td>
<td>481</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">219</td>
<td>Sierra Leone *</td>
<td>Africa</td>
<td>494</td>
<td>516</td>
<td>475</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">220</td>
<td>South Sudan *</td>
<td>Africa</td>
<td>328</td>
<td>1120</td>
<td>1421</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">221</td>
<td>Burundi *</td>
<td>Africa</td>
<td>293</td>
<td>237</td>
<td>286</td>
</tr>
</tbody>
</table>

<p>222 rows × 5 columns</p>
</div>
</div>
</div>
</section>
<section id="section-5" class="level4" data-number="8.1.4.6">
<h4 data-number="8.1.4.6" class="anchored" data-anchor-id="section-5"><span class="header-section-number">8.1.4.6</span> </h4>
<p>In the dataset obtained above, drop the inner level of the column labels. Use the <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.droplevel.html"><code>droplevel()</code></a> method.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>gdp_per_capita <span class="op">=</span> gdp_per_capita.droplevel(<span class="dv">1</span>,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>gdp_per_capita</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Country/Territory</th>
<th data-quarto-table-cell-role="th">UN Region</th>
<th data-quarto-table-cell-role="th">IMF[4]</th>
<th data-quarto-table-cell-role="th">World Bank[5]</th>
<th data-quarto-table-cell-role="th">United Nations[6]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Liechtenstein *</td>
<td>Europe</td>
<td>—</td>
<td>169049</td>
<td>180227</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Monaco *</td>
<td>Europe</td>
<td>—</td>
<td>173688</td>
<td>173696</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Luxembourg *</td>
<td>Europe</td>
<td>127673</td>
<td>135683</td>
<td>117182</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Bermuda *</td>
<td>Americas</td>
<td>—</td>
<td>110870</td>
<td>123945</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Ireland *</td>
<td>Europe</td>
<td>102217</td>
<td>99152</td>
<td>86251</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">217</td>
<td>Madagascar *</td>
<td>Africa</td>
<td>522</td>
<td>515</td>
<td>470</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">218</td>
<td>Central African Republic *</td>
<td>Africa</td>
<td>496</td>
<td>512</td>
<td>481</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">219</td>
<td>Sierra Leone *</td>
<td>Africa</td>
<td>494</td>
<td>516</td>
<td>475</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">220</td>
<td>South Sudan *</td>
<td>Africa</td>
<td>328</td>
<td>1120</td>
<td>1421</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">221</td>
<td>Burundi *</td>
<td>Africa</td>
<td>293</td>
<td>237</td>
<td>286</td>
</tr>
</tbody>
</table>

<p>222 rows × 5 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="practice-exercise-2" class="level3" data-number="8.1.5">
<h3 data-number="8.1.5" class="anchored" data-anchor-id="practice-exercise-2"><span class="header-section-number">8.1.5</span> Practice exercise 2</h3>
<p>Recall problem <a href="https://nustat.github.io/DataScience_Intro_python/Assignment%203%20(Pandas).html#e-1">2(e)</a> from assignment 3 on Pandas, where we needed to find the African country that is the closest to country <span class="math inline">\(G\)</span> (Luxembourg) with regard to social indicators.</p>
<p>We will solve the question with the regular way in which we use single level of indexing (as you probably did during this assignment), and see if it is easier to do with hierarchical indexing.</p>
<p>Execute the code below that we used to pre-process data to make it suitable for answering this question.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pre-processing data - execute this code</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>social_indicator <span class="op">=</span> pd.read_csv(<span class="st">"./Datasets/social_indicator.txt"</span>,sep<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>,index_col <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>social_indicator.geographic_location <span class="op">=</span> social_indicator.geographic_location.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Asia'</span> <span class="cf">if</span> <span class="st">'Asia'</span> <span class="kw">in</span> x <span class="cf">else</span> <span class="st">'Europe'</span> <span class="cf">if</span> <span class="st">'Europe'</span> <span class="kw">in</span> x <span class="cf">else</span> <span class="st">'Africa'</span> <span class="cf">if</span> <span class="st">'Africa'</span> <span class="kw">in</span> x <span class="cf">else</span> x)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>social_indicator.rename(columns<span class="op">=</span>{<span class="st">'geographic_location'</span>:<span class="st">'continent'</span>},inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>social_indicator <span class="op">=</span> social_indicator.sort_index(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>social_indicator.drop(columns<span class="op">=</span>[<span class="st">'region'</span>,<span class="st">'contraception'</span>],inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Below is the code to find the African country that is the closest to country <span class="math inline">\(G\)</span> (Luxembourg) using single level of indexing. Your code in the assignment is probably similar to the one below:</p>
<div class="cell" data-execution_count="344">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Finding the index of the country G (Luxembourg) that has the maximum GDP per capita</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>country_max_gdp_position <span class="op">=</span> social_indicator.gdpPerCapita.argmax()</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Scaling the social indicator dataset</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>social_indicator_scaled <span class="op">=</span> social_indicator.iloc[:,<span class="dv">2</span>:].<span class="bu">apply</span>(<span class="kw">lambda</span> x: (x<span class="op">-</span>x.mean())<span class="op">/</span>(x.std()))</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Computing the Manhattan distances of all countries from country G (Luxembourg)</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>manhattan_distances <span class="op">=</span> (social_indicator_scaled<span class="op">-</span>social_indicator_scaled.iloc[country_max_gdp_position,:]).<span class="bu">abs</span>().<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Finding the indices of African countries</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>african_countries_indices <span class="op">=</span> social_indicator.loc[social_indicator.continent<span class="op">==</span><span class="st">'Africa'</span>,:].index</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Filtering the Manhattan distances of African countries from country G (Luxembourg)</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>manhattan_distances_African <span class="op">=</span> manhattan_distances[african_countries_indices]</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Finding the country among African countries that has the least Manhattan distance to country G (Luxembourg)</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>social_indicator.loc[manhattan_distances_African.idxmin(),<span class="st">'country'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="344">
<pre><code>'Reunion'</code></pre>
</div>
</div>
<section id="section-6" class="level4" data-number="8.1.5.1">
<h4 data-number="8.1.5.1" class="anchored" data-anchor-id="section-6"><span class="header-section-number">8.1.5.1</span> </h4>
<p>Use the method <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.set_index.html"><code>set_index()</code></a> to set <code>continent</code> and <code>country</code> as hierarchical indices of rows. Find the African country that is the closest to country <span class="math inline">\(G\)</span> (Luxembourg) using this hierarchically indexed data. How many lines will be eliminated from the code above? Which lines will be eliminated?</p>
<p><strong>Hint:</strong> Since <code>continent</code> and <code>country</code> are row indices, you don’t need to explicitly find:</p>
<ol type="1">
<li><p>The row index of country <span class="math inline">\(G\)</span> (Luxembourg),</p></li>
<li><p>The row indices of African countries.</p></li>
<li><p>The Manhattan distances for African countries.</p></li>
</ol>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>social_indicator.set_index([<span class="st">'continent'</span>,<span class="st">'country'</span>],inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>social_indicator_scaled <span class="op">=</span> social_indicator.<span class="bu">apply</span>(<span class="kw">lambda</span> x: (x<span class="op">-</span>x.mean())<span class="op">/</span>(x.std()))</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>manhattan_distances <span class="op">=</span> (social_indicator_scaled<span class="op">-</span>social_indicator_scaled.loc[(<span class="st">'Europe'</span>,<span class="st">'Luxembourg'</span>),:]).<span class="bu">abs</span>().<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>manhattan_distances[<span class="st">'Africa'</span>].idxmin()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>'Reunion'</code></pre>
</div>
</div>
<p>As we have converted the columns <code>continent</code> and <code>country</code> to row indices, all the lines of code where we were keeping track of the index of country <span class="math inline">\(G\)</span>, African countries, and Manhattan distances of African countries are eliminated. Three lines of code are eliminated.</p>
<p>Hierarchical indexing relieves us from keeping track of indices, if we set indices that are relatable to our analysis.</p>
</section>
<section id="section-7" class="level4" data-number="8.1.5.2">
<h4 data-number="8.1.5.2" class="anchored" data-anchor-id="section-7"><span class="header-section-number">8.1.5.2</span> </h4>
<p>Use the Pandas DataFrame method <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.mean.html"><code>mean()</code></a> with the <em>level</em> argument to find the mean value of all social indicators for each continent.</p>
<div class="cell" data-execution_count="350">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>social_indicator.mean(level<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="350">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">economicActivityFemale</th>
<th data-quarto-table-cell-role="th">economicActivityMale</th>
<th data-quarto-table-cell-role="th">gdpPerCapita</th>
<th data-quarto-table-cell-role="th">illiteracyFemale</th>
<th data-quarto-table-cell-role="th">illiteracyMale</th>
<th data-quarto-table-cell-role="th">infantMortality</th>
<th data-quarto-table-cell-role="th">lifeFemale</th>
<th data-quarto-table-cell-role="th">lifeMale</th>
<th data-quarto-table-cell-role="th">totalfertilityrate</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Asia</td>
<td>41.592683</td>
<td>79.282927</td>
<td>27796.390244</td>
<td>23.635951</td>
<td>13.780878</td>
<td>39.853659</td>
<td>70.724390</td>
<td>66.575610</td>
<td>3.482927</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Africa</td>
<td>46.732258</td>
<td>79.445161</td>
<td>7127.483871</td>
<td>52.907226</td>
<td>33.673548</td>
<td>77.967742</td>
<td>56.841935</td>
<td>53.367742</td>
<td>4.889677</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Oceania</td>
<td>51.280000</td>
<td>77.953333</td>
<td>14525.666667</td>
<td>9.666667</td>
<td>6.585200</td>
<td>23.666667</td>
<td>72.406667</td>
<td>67.813333</td>
<td>3.509333</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">North America</td>
<td>45.238095</td>
<td>77.166667</td>
<td>18609.047619</td>
<td>17.390286</td>
<td>14.609905</td>
<td>22.904762</td>
<td>75.457143</td>
<td>70.161905</td>
<td>2.804286</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">South America</td>
<td>42.008333</td>
<td>75.575000</td>
<td>15925.916667</td>
<td>9.991667</td>
<td>6.750000</td>
<td>34.750000</td>
<td>72.691667</td>
<td>66.975000</td>
<td>2.872500</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Europe</td>
<td>52.060000</td>
<td>70.291429</td>
<td>45438.200000</td>
<td>2.308343</td>
<td>1.413543</td>
<td>10.571429</td>
<td>77.757143</td>
<td>70.374286</td>
<td>1.581714</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="practice-exercise-3" class="level3" data-number="8.1.6">
<h3 data-number="8.1.6" class="anchored" data-anchor-id="practice-exercise-3"><span class="header-section-number">8.1.6</span> Practice exercise 3</h3>
<p>Let us try to find the areas where NU students lack in diversity. Read <em>survey_data_clean.csv</em>. Use hierarchical indexing to classify the columns as follows:</p>
<p>Classify the following variables as <em>lifestyle</em>:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>lifestyle <span class="op">=</span> [<span class="st">'fav_alcohol'</span>, <span class="st">'parties_per_month'</span>, <span class="st">'smoke'</span>, <span class="st">'weed'</span>,<span class="st">'streaming_platforms'</span>, <span class="st">'minutes_ex_per_week'</span>,</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">'sleep_hours_per_day'</span>, <span class="st">'internet_hours_per_day'</span>, <span class="st">'procrastinator'</span>, <span class="st">'num_clubs'</span>,<span class="st">'student_athlete'</span>,<span class="st">'social_media'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Classify the following variables as <em>personality</em>:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>personality <span class="op">=</span> [<span class="st">'introvert_extrovert'</span>, <span class="st">'left_right_brained'</span>, <span class="st">'personality_type'</span>, </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">'num_insta_followers'</span>, <span class="st">'fav_sport'</span>,<span class="st">'learning_style'</span>,<span class="st">'dominant_hand'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Classify the following variables as <em>opinion</em>:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>opinion <span class="op">=</span> [<span class="st">'love_first_sight'</span>, <span class="st">'expected_marriage_age'</span>,  <span class="st">'expected_starting_salary'</span>, <span class="st">'how_happy'</span>, </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">'fav_number'</span>, <span class="st">'fav_letter'</span>, <span class="st">'fav_season'</span>,   <span class="st">'political_affliation'</span>, <span class="st">'cant_change_math_ability'</span>,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'can_change_math_ability'</span>, <span class="st">'math_is_genetic'</span>, <span class="st">'much_effort_is_lack_of_talent'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Classify the following variables as <em>academic information</em>:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>academic_info <span class="op">=</span> [<span class="st">'major'</span>, <span class="st">'num_majors_minors'</span>,</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">'high_school_GPA'</span>, <span class="st">'NU_GPA'</span>, <span class="st">'school_year'</span>,<span class="st">'AP_stats'</span>, <span class="st">'used_python_before'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Classify the following variables as <em>demographics</em>:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>demographics <span class="op">=</span> [ <span class="st">'only_child'</span>,<span class="st">'birth_month'</span>, </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">'living_location_on_campus'</span>, <span class="st">'age'</span>, <span class="st">'height'</span>, <span class="st">'height_father'</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'height_mother'</span>,  <span class="st">'childhood_in_US'</span>, <span class="st">'gender'</span>, <span class="st">'region_of_residence'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Write a function that finds the number of variables having outliers in a dataset. Apply the function to each of the 5 categories of variables in the dataset. Our hypothesis is that the category that has the maximum number of variables with outliers has the least amount of diversity. For continuous variables, use Tukey’s fences criterion to identify outliers. For categorical variables, consider levels having less than 1% observations as outliers. Assume that numeric variables that have more than 2 distinct values are continuous.</p>
<p><strong>Solution:</strong></p>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Using hierarchical indexing to classify columns</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Reading data</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>survey_data <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/survey_data_clean.csv'</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Arranging columns in the order of categories</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>survey_data_HI <span class="op">=</span> survey_data[lifestyle<span class="op">+</span>personality<span class="op">+</span>opinion<span class="op">+</span>academic_info<span class="op">+</span>demographics]</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating hierarchical indexing to classify columns</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>survey_data_HI.columns<span class="op">=</span>[[<span class="st">'lifestyle'</span>]<span class="op">*</span><span class="bu">len</span>(lifestyle)<span class="op">+</span>[<span class="st">'personality'</span>]<span class="op">*</span><span class="bu">len</span>(personality)<span class="op">+</span>[<span class="st">'opinion'</span>]<span class="op">*</span><span class="bu">len</span>(opinion)<span class="op">+\</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>                       [<span class="st">'academic_info'</span>]<span class="op">*</span><span class="bu">len</span>(academic_info)<span class="op">+</span>[<span class="st">'demographics'</span>]<span class="op">*</span><span class="bu">len</span>(demographics),lifestyle<span class="op">+\</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>                        personality<span class="op">+</span>opinion<span class="op">+</span>academic_info<span class="op">+</span>demographics]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Function to identify outliers based on Tukey's fences for continous variables and 1% criterion for categorical variables</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rem_outliers(x):</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ((<span class="bu">len</span>(x.value_counts())<span class="op">&gt;</span><span class="dv">2</span>) <span class="op">&amp;</span> (x.dtype<span class="op">!=</span><span class="st">'O'</span>)):<span class="co">#continuous variable</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>        q1 <span class="op">=</span>x.quantile(<span class="fl">0.25</span>)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>        q3 <span class="op">=</span> x.quantile(<span class="fl">0.75</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>        intQ_range <span class="op">=</span> q3<span class="op">-</span>q1</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Tukey's fences</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>        Lower_fence <span class="op">=</span> q1 <span class="op">-</span> <span class="fl">1.5</span><span class="op">*</span>intQ_range</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>        Upper_fence <span class="op">=</span> q3 <span class="op">+</span> <span class="fl">1.5</span><span class="op">*</span>intQ_range</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>        num_outliers <span class="op">=</span> ((x<span class="op">&lt;</span>Lower_fence) <span class="op">|</span> (x<span class="op">&gt;</span>Upper_fence)).<span class="bu">sum</span>()</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> num_outliers<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:                                       <span class="co">#categorical variable</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> np.<span class="bu">min</span>(x.value_counts()<span class="op">/</span><span class="bu">len</span>(x))<span class="op">&lt;</span><span class="fl">0.01</span>:</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Number of variables containing outlier(s) in each category</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category <span class="kw">in</span> survey_data_HI.columns.get_level_values(<span class="dv">0</span>).unique():</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Number of missing values for category "</span>,category,<span class="st">" = "</span>,survey_data_HI[category].<span class="bu">apply</span>(rem_outliers).<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of missing values for category  lifestyle  =  7
Number of missing values for category  personality  =  2
Number of missing values for category  opinion  =  4
Number of missing values for category  academic_info  =  3
Number of missing values for category  demographics  =  4</code></pre>
</div>
</div>
<p>The <em>lifestyle</em> category has the highest number of variables containing outlier(s). If the hypothesis is true, then NU students have the least diversity in their lifestyle, among all the categories.</p>
<p>Although one may say that the <em>lifestyle</em> category has the the highest number of columns (as shown below), the proportion of columns having outlier(s) is also the highest for this category.</p>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category <span class="kw">in</span> survey_data_HI.columns.get_level_values(<span class="dv">0</span>).unique():</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Number of columns in category "</span>,category,<span class="st">" = "</span>,survey_data_HI[category].shape[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of columns in category  lifestyle  =  12
Number of columns in category  personality  =  7
Number of columns in category  opinion  =  12
Number of columns in category  academic_info  =  7
Number of columns in category  demographics  =  10</code></pre>
</div>
</div>
</section>
<section id="reshaping-data" class="level3" data-number="8.1.7">
<h3 data-number="8.1.7" class="anchored" data-anchor-id="reshaping-data"><span class="header-section-number">8.1.7</span> Reshaping data</h3>
<p>Apart from ease in subsetting data, hierarchical indexing also plays a role in reshaping data.</p>
<section id="unstack-pandas-series-method" class="level4" data-number="8.1.7.1">
<h4 data-number="8.1.7.1" class="anchored" data-anchor-id="unstack-pandas-series-method"><span class="header-section-number">8.1.7.1</span> <a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.unstack.html"><code>unstack()</code></a> (Pandas Series method)</h4>
<p>The Pandas Series method <code>unstack()</code> pivots the desired level of row indices to columns, thereby creating a DataFrame. By default, the inner-most level of the row labels is pivoted.</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pivoting the inner-most Series row index to column labels</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>series_example_unstack <span class="op">=</span> series_example.unstack()</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>series_example_unstack</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">English</td>
<td>these</td>
<td>are</td>
<td>english</td>
<td>words</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">French</td>
<td>ce</td>
<td>sont</td>
<td>des</td>
<td>françai</td>
<td>mots</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Spanish</td>
<td>estas</td>
<td>son</td>
<td>palabras</td>
<td>en</td>
<td>español</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can pivot the outer level of the row labels by specifying it in the <code>level</code> argument:</p>
<div class="cell" data-execution_count="192">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pivoting the outer row indices to column labels</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>series_example_unstack <span class="op">=</span> series_example.unstack(level<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>series_example_unstack</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="192">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">English</th>
<th data-quarto-table-cell-role="th">French</th>
<th data-quarto-table-cell-role="th">Spanish</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>these</td>
<td>ce</td>
<td>estas</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>are</td>
<td>sont</td>
<td>son</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>english</td>
<td>des</td>
<td>palabras</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>words</td>
<td>françai</td>
<td>en</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>NaN</td>
<td>mots</td>
<td>español</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="unstack-pandas-dataframe-method" class="level4" data-number="8.1.7.2">
<h4 data-number="8.1.7.2" class="anchored" data-anchor-id="unstack-pandas-dataframe-method"><span class="header-section-number">8.1.7.2</span> <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.unstack.html"><code>unstack()</code></a> (Pandas DataFrame method)</h4>
<p>The Pandas DataFrame method <code>unstack()</code> pivots the specified level of row indices to the new inner-most level of column labels. By default, the inner-most level of the row labels is pivoted.</p>
<div class="cell" data-execution_count="181">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pivoting the inner level of row labels to the inner-most level of column labels</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>df_example.unstack()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="181">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">State</th>
<th colspan="8" data-quarto-table-cell-role="th" data-halign="left">Illinois</th>
<th colspan="8" data-quarto-table-cell-role="th" data-halign="left">California</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">City</th>
<th colspan="4" data-quarto-table-cell-role="th" data-halign="left">Evanston</th>
<th colspan="4" data-quarto-table-cell-role="th" data-halign="left">Chicago</th>
<th colspan="4" data-quarto-table-cell-role="th" data-halign="left">San Francisco</th>
<th colspan="4" data-quarto-table-cell-role="th" data-halign="left">Los Angeles</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">Statistic</th>
<th data-quarto-table-cell-role="th">Area (mile-sq)</th>
<th data-quarto-table-cell-role="th">Elevation (feet)</th>
<th data-quarto-table-cell-role="th">Population</th>
<th data-quarto-table-cell-role="th">Unemployement (%)</th>
<th data-quarto-table-cell-role="th">Area (mile-sq)</th>
<th data-quarto-table-cell-role="th">Elevation (feet)</th>
<th data-quarto-table-cell-role="th">Population</th>
<th data-quarto-table-cell-role="th">Unemployement (%)</th>
<th data-quarto-table-cell-role="th">Area (mile-sq)</th>
<th data-quarto-table-cell-role="th">Elevation (feet)</th>
<th data-quarto-table-cell-role="th">Population</th>
<th data-quarto-table-cell-role="th">Unemployement (%)</th>
<th data-quarto-table-cell-role="th">Area (mile-sq)</th>
<th data-quarto-table-cell-role="th">Elevation (feet)</th>
<th data-quarto-table-cell-role="th">Population</th>
<th data-quarto-table-cell-role="th">Unemployement (%)</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Information type</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Demographics</td>
<td>NaN</td>
<td>NaN</td>
<td>771517.0</td>
<td>4.2</td>
<td>NaN</td>
<td>NaN</td>
<td>2697000.0</td>
<td>5.6</td>
<td>NaN</td>
<td>NaN</td>
<td>815201.0</td>
<td>2.8</td>
<td>NaN</td>
<td>NaN</td>
<td>3849000.0</td>
<td>4.6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Geography</td>
<td>7.8</td>
<td>6749.0</td>
<td>NaN</td>
<td>NaN</td>
<td>234.5</td>
<td>597.0</td>
<td>NaN</td>
<td>NaN</td>
<td>46.9</td>
<td>52.0</td>
<td>NaN</td>
<td>NaN</td>
<td>502.0</td>
<td>305.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>As with Series, we can pivot the outer level of the row labels by specifying it in the <code>level</code> argument:</p>
<div class="cell" data-execution_count="188">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pivoting the outer level (level = 0) of row labels to the inner-most level of column labels</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>df_example.unstack(level<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="188">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">State</th>
<th colspan="4" data-quarto-table-cell-role="th" data-halign="left">Illinois</th>
<th colspan="4" data-quarto-table-cell-role="th" data-halign="left">California</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">City</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">Evanston</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">Chicago</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">San Francisco</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">Los Angeles</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">Information type</th>
<th data-quarto-table-cell-role="th">Demographics</th>
<th data-quarto-table-cell-role="th">Geography</th>
<th data-quarto-table-cell-role="th">Demographics</th>
<th data-quarto-table-cell-role="th">Geography</th>
<th data-quarto-table-cell-role="th">Demographics</th>
<th data-quarto-table-cell-role="th">Geography</th>
<th data-quarto-table-cell-role="th">Demographics</th>
<th data-quarto-table-cell-role="th">Geography</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Statistic</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Area (mile-sq)</td>
<td>NaN</td>
<td>7.8</td>
<td>NaN</td>
<td>234.5</td>
<td>NaN</td>
<td>46.9</td>
<td>NaN</td>
<td>502.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Elevation (feet)</td>
<td>NaN</td>
<td>6749.0</td>
<td>NaN</td>
<td>597.0</td>
<td>NaN</td>
<td>52.0</td>
<td>NaN</td>
<td>305.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Population</td>
<td>771517.0</td>
<td>NaN</td>
<td>2697000.0</td>
<td>NaN</td>
<td>815201.0</td>
<td>NaN</td>
<td>3849000.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Unemployement (%)</td>
<td>4.2</td>
<td>NaN</td>
<td>5.6</td>
<td>NaN</td>
<td>2.8</td>
<td>NaN</td>
<td>4.6</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="stack" class="level4" data-number="8.1.7.3">
<h4 data-number="8.1.7.3" class="anchored" data-anchor-id="stack"><span class="header-section-number">8.1.7.3</span> <code>stack()</code></h4>
<p>The inverse of <code>unstack()</code> is the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.stack.html"><code>stack()</code></a> method, which creates the inner-most level of row indices by pivoting the column labels of the prescribed level.</p>
<p>Note that if the column labels have only one level, we don’t need to specify a level.</p>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Stacking the columns of a DataFrame</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>series_example_unstack.stack()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<pre><code>English  1       these
         2         are
         3     english
         4       words
French   1          ce
         2        sont
         3         des
         4     françai
         5        mots
Spanish  1       estas
         2         son
         3    palabras
         4          en
         5     español
dtype: object</code></pre>
</div>
</div>
<p>However, if the columns have multiple levels, we can specify the level to stack as the inner-most row level. By default, the inner-most column level is stacked.</p>
<div class="cell" data-execution_count="195">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Stacking the inner-most column labels inner-most row indices</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>df_example.stack()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="195">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">State</th>
<th data-quarto-table-cell-role="th">California</th>
<th data-quarto-table-cell-role="th">Illinois</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Information type</th>
<th data-quarto-table-cell-role="th">Statistic</th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="8" data-quarto-table-cell-role="th" data-valign="top">Demographics</td>
<td rowspan="4" data-quarto-table-cell-role="th" data-valign="top">Population</td>
<td data-quarto-table-cell-role="th">Chicago</td>
<td>NaN</td>
<td>2697000.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Evanston</td>
<td>NaN</td>
<td>771517.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Los Angeles</td>
<td>3849000.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">San Francisco</td>
<td>815201.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td rowspan="4" data-quarto-table-cell-role="th" data-valign="top">Unemployement (%)</td>
<td data-quarto-table-cell-role="th">Chicago</td>
<td>NaN</td>
<td>5.6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Evanston</td>
<td>NaN</td>
<td>4.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Los Angeles</td>
<td>4.6</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">San Francisco</td>
<td>2.8</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td rowspan="8" data-quarto-table-cell-role="th" data-valign="top">Geography</td>
<td rowspan="4" data-quarto-table-cell-role="th" data-valign="top">Area (mile-sq)</td>
<td data-quarto-table-cell-role="th">Chicago</td>
<td>NaN</td>
<td>234.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Evanston</td>
<td>NaN</td>
<td>7.8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Los Angeles</td>
<td>502.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">San Francisco</td>
<td>46.9</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td rowspan="4" data-quarto-table-cell-role="th" data-valign="top">Elevation (feet)</td>
<td data-quarto-table-cell-role="th">Chicago</td>
<td>NaN</td>
<td>597.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Evanston</td>
<td>NaN</td>
<td>6749.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Los Angeles</td>
<td>305.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">San Francisco</td>
<td>52.0</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="196">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Stacking the outer column labels inner-most row indices</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>df_example.stack(level<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="196">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">Chicago</th>
<th data-quarto-table-cell-role="th">Evanston</th>
<th data-quarto-table-cell-role="th">Los Angeles</th>
<th data-quarto-table-cell-role="th">San Francisco</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Information type</th>
<th data-quarto-table-cell-role="th">Statistic</th>
<th data-quarto-table-cell-role="th">State</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="4" data-quarto-table-cell-role="th" data-valign="top">Demographics</td>
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Population</td>
<td data-quarto-table-cell-role="th">California</td>
<td>NaN</td>
<td>NaN</td>
<td>3849000.0</td>
<td>815201.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Illinois</td>
<td>2697000.0</td>
<td>771517.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Unemployement (%)</td>
<td data-quarto-table-cell-role="th">California</td>
<td>NaN</td>
<td>NaN</td>
<td>4.6</td>
<td>2.8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Illinois</td>
<td>5.6</td>
<td>4.2</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td rowspan="4" data-quarto-table-cell-role="th" data-valign="top">Geography</td>
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Area (mile-sq)</td>
<td data-quarto-table-cell-role="th">California</td>
<td>NaN</td>
<td>NaN</td>
<td>502.0</td>
<td>46.9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Illinois</td>
<td>234.5</td>
<td>7.8</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Elevation (feet)</td>
<td data-quarto-table-cell-role="th">California</td>
<td>NaN</td>
<td>NaN</td>
<td>305.0</td>
<td>52.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Illinois</td>
<td>597.0</td>
<td>6749.0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
</section>
<section id="merging-data" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="merging-data"><span class="header-section-number">8.2</span> Merging data</h2>
<p>The Pandas DataFrame method <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.merge.html">merge()</a> uses columns defined as <em>key</em> column(s) to merge two datasets. In case the <em>key</em> column(s) are not defined, the overlapping column(s) are considered as the <em>key</em> columns.</p>
<section id="join-types" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="join-types"><span class="header-section-number">8.2.1</span> Join types</h3>
<p>When a dataset is merged with another based on <em>key</em> column(s), one of the following four types of join will occur depending on the repetition of the values of the key(s) in the datasets.</p>
<ol type="i">
<li>One-to-one, (ii) Many-to-one, (iii) One-to-Many, and (iv) Many-to-many</li>
</ol>
<p>The type of join may sometimes determine the number of rows to be obtained in the merged dataset. If we don’t get the expected number of rows in the merged dataset, an investigation of the datsets may be neccessary to identify and resolve the issue. There may be several possible issues, for example, the dataset may not be arranged in a way that we have assumed it to be arranged.</p>
<p>We’ll use toy datasets to understand the above types of joins. The <em>.csv</em> files with the prefix <em>student</em> consist of the names of a few students along with their majors, and the files with the prefix <em>skills</em> consist of the names of majors along with the skills imparted by the respective majors.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>data_student <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/student_one.csv'</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>data_skill <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/skills_one.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="one-to-one-join" class="level4" data-number="8.2.1.1">
<h4 data-number="8.2.1.1" class="anchored" data-anchor-id="one-to-one-join"><span class="header-section-number">8.2.1.1</span> One-to-one join</h4>
<p>Each row in one dataset is linked (or related) to a single row in another dataset based on the key column(s).</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>data_student</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Student</th>
<th data-quarto-table-cell-role="th">Major</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Kitana</td>
<td>Statistics</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Jax</td>
<td>Computer Science</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Sonya</td>
<td>Material Science</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Johnny</td>
<td>Music</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>data_skill</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Major</th>
<th data-quarto-table-cell-role="th">Skills</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Statistics</td>
<td>Inference</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Computer Science</td>
<td>Machine learning</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Material Science</td>
<td>Structure prediction</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Music</td>
<td>Opera</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>pd.merge(data_student,data_skill)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Student</th>
<th data-quarto-table-cell-role="th">Major</th>
<th data-quarto-table-cell-role="th">Skills</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Kitana</td>
<td>Statistics</td>
<td>Inference</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Jax</td>
<td>Computer Science</td>
<td>Machine learning</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Sonya</td>
<td>Material Science</td>
<td>Structure prediction</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Johnny</td>
<td>Music</td>
<td>Opera</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="many-to-one-join" class="level4" data-number="8.2.1.2">
<h4 data-number="8.2.1.2" class="anchored" data-anchor-id="many-to-one-join"><span class="header-section-number">8.2.1.2</span> Many-to-one join</h4>
<p>One or more rows in one dataset is linked (or related) to a single row in another dataset based on the key column(s).</p>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>data_student <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/student_many.csv'</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>data_skill <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/skills_one.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>data_student</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Student</th>
<th data-quarto-table-cell-role="th">Major</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Kitana</td>
<td>Statistics</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Kitana</td>
<td>Computer Science</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Jax</td>
<td>Computer Science</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Sonya</td>
<td>Material Science</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Johnny</td>
<td>Music</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Johnny</td>
<td>Statistics</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>data_skill</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Major</th>
<th data-quarto-table-cell-role="th">Skills</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Statistics</td>
<td>Inference</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Computer Science</td>
<td>Machine learning</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Material Science</td>
<td>Structure prediction</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Music</td>
<td>Opera</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="33">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>pd.merge(data_student,data_skill)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Student</th>
<th data-quarto-table-cell-role="th">Major</th>
<th data-quarto-table-cell-role="th">Skills</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Kitana</td>
<td>Statistics</td>
<td>Inference</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Johnny</td>
<td>Statistics</td>
<td>Inference</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Kitana</td>
<td>Computer Science</td>
<td>Machine learning</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Jax</td>
<td>Computer Science</td>
<td>Machine learning</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Sonya</td>
<td>Material Science</td>
<td>Structure prediction</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Johnny</td>
<td>Music</td>
<td>Opera</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="one-to-many-join" class="level4" data-number="8.2.1.3">
<h4 data-number="8.2.1.3" class="anchored" data-anchor-id="one-to-many-join"><span class="header-section-number">8.2.1.3</span> One-to-many join</h4>
<p>Each row in one dataset is linked (or related) to one, or more rows in another dataset based on the key column(s).</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>data_student <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/student_one.csv'</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>data_skill <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/skills_many.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>data_student</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Student</th>
<th data-quarto-table-cell-role="th">Major</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Kitana</td>
<td>Statistics</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Jax</td>
<td>Computer Science</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Sonya</td>
<td>Material Science</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Johnny</td>
<td>Music</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>data_skill</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Major</th>
<th data-quarto-table-cell-role="th">Skills</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Statistics</td>
<td>Inference</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Statistics</td>
<td>Modeling</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Computer Science</td>
<td>Machine learning</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Computer Science</td>
<td>Computing</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Material Science</td>
<td>Structure prediction</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Music</td>
<td>Opera</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Music</td>
<td>Pop</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Music</td>
<td>Classical</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>pd.merge(data_student,data_skill)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Student</th>
<th data-quarto-table-cell-role="th">Major</th>
<th data-quarto-table-cell-role="th">Skills</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Kitana</td>
<td>Statistics</td>
<td>Inference</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Kitana</td>
<td>Statistics</td>
<td>Modeling</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Jax</td>
<td>Computer Science</td>
<td>Machine learning</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Jax</td>
<td>Computer Science</td>
<td>Computing</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Sonya</td>
<td>Material Science</td>
<td>Structure prediction</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Johnny</td>
<td>Music</td>
<td>Opera</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Johnny</td>
<td>Music</td>
<td>Pop</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Johnny</td>
<td>Music</td>
<td>Classical</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="many-to-many-join" class="level4" data-number="8.2.1.4">
<h4 data-number="8.2.1.4" class="anchored" data-anchor-id="many-to-many-join"><span class="header-section-number">8.2.1.4</span> Many-to-many join</h4>
<p>One, or more, rows in one dataset is linked (or related) to one, or more, rows in another dataset using the key column(s).</p>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>data_student <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/student_many.csv'</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>data_skill <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/skills_many.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="74">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>data_student</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Student</th>
<th data-quarto-table-cell-role="th">Major</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Kitana</td>
<td>Statistics</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Kitana</td>
<td>Computer Science</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Jax</td>
<td>Computer Science</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Sonya</td>
<td>Material Science</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Johnny</td>
<td>Music</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Johnny</td>
<td>Statistics</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="75">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>data_skill</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Major</th>
<th data-quarto-table-cell-role="th">Skills</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Statistics</td>
<td>Inference</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Statistics</td>
<td>Modeling</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Computer Science</td>
<td>Machine learning</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Computer Science</td>
<td>Computing</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Material Science</td>
<td>Structure prediction</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Music</td>
<td>Opera</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Music</td>
<td>Pop</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Music</td>
<td>Classical</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>pd.merge(data_student,data_skill)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Student</th>
<th data-quarto-table-cell-role="th">Major</th>
<th data-quarto-table-cell-role="th">Skills</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Kitana</td>
<td>Statistics</td>
<td>Inference</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Kitana</td>
<td>Statistics</td>
<td>Modeling</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Johnny</td>
<td>Statistics</td>
<td>Inference</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Johnny</td>
<td>Statistics</td>
<td>Modeling</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Kitana</td>
<td>Computer Science</td>
<td>Machine learning</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Kitana</td>
<td>Computer Science</td>
<td>Computing</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Jax</td>
<td>Computer Science</td>
<td>Machine learning</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Jax</td>
<td>Computer Science</td>
<td>Computing</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Sonya</td>
<td>Material Science</td>
<td>Structure prediction</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Johnny</td>
<td>Music</td>
<td>Opera</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>Johnny</td>
<td>Music</td>
<td>Pop</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>Johnny</td>
<td>Music</td>
<td>Classical</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Note that there are two ‘<em>Statistics</em>’ rows in <code>data_student</code>, and two ‘<em>Statistics</em>’ rows in <code>data_skill</code>, resulting in 2x2 = 4 ‘<em>Statistics</em>’ rows in the merged data. The same is true for the ‘<em>Computer Science</em>’ <code>Major</code>.</p>
</section>
</section>
<section id="join-types-with-how-argument" class="level3" data-number="8.2.2">
<h3 data-number="8.2.2" class="anchored" data-anchor-id="join-types-with-how-argument"><span class="header-section-number">8.2.2</span> Join types with <code>how</code> argument</h3>
<p>The above mentioned types of join (one-to-one, many-to-one, etc.) occur depening on the structure of the datasets being merged. We don’t have control over the type of join. However, we can control <code>how</code> the joins are occurring. We can merge (or <em>join</em>) two datasets in one of the following four ways:</p>
<ol type="i">
<li><code>inner</code> join, (ii) <code>left</code> join, (iii) <code>right</code> join, (iv) <code>outer</code> join</li>
</ol>
<section id="inner-join" class="level4" data-number="8.2.2.1">
<h4 data-number="8.2.2.1" class="anchored" data-anchor-id="inner-join"><span class="header-section-number">8.2.2.1</span> inner join</h4>
<p>This is the join that occurs by default, i.e., without specifying the <code>how</code> argument in the <code>merge()</code> function. In <code>inner</code> join, only those observations are merged that have the same value(s) in the <em>key</em> column(s) of both the datasets.</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>data_student <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/student_how.csv'</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>data_skill <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/skills_how.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>data_student</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Student</th>
<th data-quarto-table-cell-role="th">Major</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Kitana</td>
<td>Statistics</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Jax</td>
<td>Computer Science</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Sonya</td>
<td>Material Science</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>data_skill</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Major</th>
<th data-quarto-table-cell-role="th">Skills</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Statistics</td>
<td>Inference</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Computer Science</td>
<td>Machine learning</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Music</td>
<td>Opera</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="395">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>pd.merge(data_student,data_skill)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="395">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Student</th>
<th data-quarto-table-cell-role="th">Major</th>
<th data-quarto-table-cell-role="th">Skills</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Kitana</td>
<td>Statistics</td>
<td>Inference</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Jax</td>
<td>Computer Science</td>
<td>Machine learning</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>When you may use inner join?</strong> You should use inner join when you cannot carry out the analysis unless the observation corresponding to the <em>key column(s)</em> is present in both the tables.</p>
<p><strong>Example:</strong> Suppose you wish to analyze the association between vaccinations and covid infection rate based on country-level data. In one of the datasets, you have the infection rate for each country, while in the other one you have the number of vaccinations in each country. The countries which have either the vaccination or the infection rate missing, cannot help analyze the association. In such as case you may be interested only in countries that have values for both the variables. Thus, you will use inner join to discard the countries with either value missing.</p>
</section>
<section id="left-join" class="level4" data-number="8.2.2.2">
<h4 data-number="8.2.2.2" class="anchored" data-anchor-id="left-join"><span class="header-section-number">8.2.2.2</span> left join</h4>
<p>In <code>left</code> join, the merged dataset will have all the rows of the dataset that is specified first in the <code>merge()</code> function. Only those observations of the other dataset will be merged whose value(s) in the <em>key</em> column(s) exist in the dataset specified first in the <code>merge()</code> function.</p>
<div class="cell" data-scrolled="true" data-execution_count="85">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>pd.merge(data_student,data_skill,how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="85">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Student</th>
<th data-quarto-table-cell-role="th">Major</th>
<th data-quarto-table-cell-role="th">Skills</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Kitana</td>
<td>Statistics</td>
<td>Inference</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Jax</td>
<td>Computer Science</td>
<td>Machine learning</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Sonya</td>
<td>Material Science</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>When you may use left join?</strong> You should use left join when the primary variable(s) of interest are present in the one of the datasets, and whose missing values cannot be imputed. The variable(s) in the other dataset may not be as important or it may be possible to reasonably impute their values, if missing corresponding to the observation in the primary dataset.</p>
<p><strong>Examples:</strong></p>
<ol type="1">
<li><p>Suppose you wish to analyze the association between the covid infection rate and the government effectiveness score (a metric used to determine the effectiveness of the government in implementing policies, upholding law and order etc.) based on the data of all countries. Let us say that one of the datasets contains the covid infection rate, while the other one contains the government effectiveness score for each country. If the infection rate for a country is missing, it might be hard to impute. However, the government effectiveness score may be easier to impute based on GDP per capita, crime rate etc. - information that is easily available online. In such a case, you may wish to use a left join where you keep all the countries for which the infection rate is known.</p></li>
<li><p>Suppose you wish to analyze the association between demographics such as age, income etc. and the amount of credit card spend. Let us say one of the datasets contains the demographic information of each customer, while the other one contains the credit card spend for the customers who made at least one purchase. In such as case, you may want to do a left join as customers not making any purchase might be absent in the card spend data. Their spend can be imputed as zero after merging the datasets.</p></li>
</ol>
</section>
<section id="right-join" class="level4" data-number="8.2.2.3">
<h4 data-number="8.2.2.3" class="anchored" data-anchor-id="right-join"><span class="header-section-number">8.2.2.3</span> right join</h4>
<p>In <code>right</code> join, the merged dataset will have all the rows of the dataset that is specified second in the <code>merge()</code> function. Only those observations of the other dataset will be merged whose value(s) in the <em>key</em> column(s) exist in the dataset specified second in the <code>merge()</code> function.</p>
<div class="cell" data-scrolled="true" data-execution_count="86">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>pd.merge(data_student,data_skill,how<span class="op">=</span><span class="st">'right'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Student</th>
<th data-quarto-table-cell-role="th">Major</th>
<th data-quarto-table-cell-role="th">Skills</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Kitana</td>
<td>Statistics</td>
<td>Inference</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Jax</td>
<td>Computer Science</td>
<td>Machine learning</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
<td>Music</td>
<td>Opera</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>When you may use right join?</strong> You can always use a left join instead of a right join. Their purpose is the same.</p>
</section>
<section id="outer-join" class="level4" data-number="8.2.2.4">
<h4 data-number="8.2.2.4" class="anchored" data-anchor-id="outer-join"><span class="header-section-number">8.2.2.4</span> outer join</h4>
<p>In <code>outer</code> join, the merged dataset will have all the rows of both the datasets being merged.</p>
<div class="cell" data-execution_count="335">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>pd.merge(data_student,data_skill,how<span class="op">=</span><span class="st">'outer'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="335">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Student</th>
<th data-quarto-table-cell-role="th">Major</th>
<th data-quarto-table-cell-role="th">Skills</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Kitana</td>
<td>Statistics</td>
<td>Inference</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Jax</td>
<td>Computer Science</td>
<td>Machine learning</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Sonya</td>
<td>Material Science</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>Music</td>
<td>Opera</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>When you may use outer join?</strong> You should use an outer join when you cannot afford to lose data present in either of the tables. All the other joins may result in loss of data.</p>
<p><strong>Example:</strong> Suppose I took two course surveys for this course. If I need to analyze student sentiment during the course, I will take an outer join of both the surveys. Assume that each survey is a dataset, where each row corresponds to a unique student. Even if a student has answered one of the two surverys, it will be indicative of the sentiment, and will be useful to keep in the merged dataset.</p>
</section>
</section>
</section>
<section id="concatenating-datasets" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="concatenating-datasets"><span class="header-section-number">8.3</span> Concatenating datasets</h2>
<p>The Pandas DataFrame method <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.concat.html"><code>concat()</code></a> is used to stack datasets along an axis. The method is similar to NumPy’s <code>concatenate()</code> method.</p>
<p><strong>Example</strong>: You are given the life expectancy data of each continent as a separate *.csv file. Visualize the change of life expectancy over time for different continents.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>data_asia <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/gdp_lifeExpec_Asia.csv'</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>data_europe <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/gdp_lifeExpec_Europe.csv'</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>data_africa <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/gdp_lifeExpec_Africa.csv'</span>)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>data_oceania <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/gdp_lifeExpec_Oceania.csv'</span>)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>data_americas <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/gdp_lifeExpec_Americas.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Appending all the data files, i.e., stacking them on top of each other</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>data_all_continents <span class="op">=</span> pd.concat([data_asia,data_europe,data_africa,data_oceania,data_americas],keys <span class="op">=</span> [<span class="st">'Asia'</span>,<span class="st">'Europe'</span>,<span class="st">'Africa'</span>,<span class="st">'Oceania'</span>,<span class="st">'Americas'</span>])</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>data_all_continents</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">lifeExp</th>
<th data-quarto-table-cell-role="th">pop</th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Asia</td>
<td data-quarto-table-cell-role="th">0</td>
<td>Afghanistan</td>
<td>1952</td>
<td>28.801</td>
<td>8425333</td>
<td>779.445314</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Afghanistan</td>
<td>1957</td>
<td>30.332</td>
<td>9240934</td>
<td>820.853030</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Afghanistan</td>
<td>1962</td>
<td>31.997</td>
<td>10267083</td>
<td>853.100710</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Afghanistan</td>
<td>1967</td>
<td>34.020</td>
<td>11537966</td>
<td>836.197138</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Afghanistan</td>
<td>1972</td>
<td>36.088</td>
<td>13079460</td>
<td>739.981106</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Americas</td>
<td data-quarto-table-cell-role="th">295</td>
<td>Venezuela</td>
<td>1987</td>
<td>70.190</td>
<td>17910182</td>
<td>9883.584648</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">296</td>
<td>Venezuela</td>
<td>1992</td>
<td>71.150</td>
<td>20265563</td>
<td>10733.926310</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">297</td>
<td>Venezuela</td>
<td>1997</td>
<td>72.146</td>
<td>22374398</td>
<td>10165.495180</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">298</td>
<td>Venezuela</td>
<td>2002</td>
<td>72.766</td>
<td>24287670</td>
<td>8605.047831</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">299</td>
<td>Venezuela</td>
<td>2007</td>
<td>73.747</td>
<td>26084662</td>
<td>11415.805690</td>
</tr>
</tbody>
</table>

<p>1704 rows × 5 columns</p>
</div>
</div>
</div>
<p>Let’s have the continent as a column as we need to use that in the visualization.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>data_all_continents.reset_index(inplace <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>data_all_continents.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">level_0</th>
<th data-quarto-table-cell-role="th">level_1</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">lifeExp</th>
<th data-quarto-table-cell-role="th">pop</th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Asia</td>
<td>0</td>
<td>Afghanistan</td>
<td>1952</td>
<td>28.801</td>
<td>8425333</td>
<td>779.445314</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Asia</td>
<td>1</td>
<td>Afghanistan</td>
<td>1957</td>
<td>30.332</td>
<td>9240934</td>
<td>820.853030</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Asia</td>
<td>2</td>
<td>Afghanistan</td>
<td>1962</td>
<td>31.997</td>
<td>10267083</td>
<td>853.100710</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Asia</td>
<td>3</td>
<td>Afghanistan</td>
<td>1967</td>
<td>34.020</td>
<td>11537966</td>
<td>836.197138</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Asia</td>
<td>4</td>
<td>Afghanistan</td>
<td>1972</td>
<td>36.088</td>
<td>13079460</td>
<td>739.981106</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>data_all_continents.drop(columns <span class="op">=</span> <span class="st">'level_1'</span>,inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>data_all_continents.rename(columns <span class="op">=</span> {<span class="st">'level_0'</span>:<span class="st">'continent'</span>},inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>data_all_continents.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">lifeExp</th>
<th data-quarto-table-cell-role="th">pop</th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Asia</td>
<td>Afghanistan</td>
<td>1952</td>
<td>28.801</td>
<td>8425333</td>
<td>779.445314</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Asia</td>
<td>Afghanistan</td>
<td>1957</td>
<td>30.332</td>
<td>9240934</td>
<td>820.853030</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Asia</td>
<td>Afghanistan</td>
<td>1962</td>
<td>31.997</td>
<td>10267083</td>
<td>853.100710</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Asia</td>
<td>Afghanistan</td>
<td>1967</td>
<td>34.020</td>
<td>11537966</td>
<td>836.197138</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Asia</td>
<td>Afghanistan</td>
<td>1972</td>
<td>36.088</td>
<td>13079460</td>
<td>739.981106</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co">#change of life expectancy over time for different continents</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> sns.FacetGrid(data_all_continents,col <span class="op">=</span> <span class="st">'continent'</span>,col_wrap <span class="op">=</span> <span class="dv">3</span>,height <span class="op">=</span> <span class="fl">4.5</span>,aspect <span class="op">=</span> <span class="dv">1</span>)<span class="co">#height = 3,aspect = 0.8)</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>a.<span class="bu">map</span>(sns.lineplot,<span class="st">'year'</span>,<span class="st">'lifeExp'</span>)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>a.add_legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Data wrangling_files/figure-html/cell-79-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>In the above example, datasets were appended (or stacked on top of each other).</p>
<p>Datasets can also be concatenated side-by-side (by providing the argument <em>axis = 1</em> with the <em>concat()</em> function) as we saw with the <em>merge</em> function.</p>
<section id="practice-exercise-4" class="level3" data-number="8.3.1">
<h3 data-number="8.3.1" class="anchored" data-anchor-id="practice-exercise-4"><span class="header-section-number">8.3.1</span> Practice exercise 4</h3>
<p>Read the documentations of the Pandas DataFrame methods <code>merge()</code> and <code>concat()</code>, and identify the differences. Mention examples when you can use (i) either, (ii) only <code>concat()</code>, (iii) only <code>merge()</code></p>
<p><strong>Solution:</strong></p>
<ol type="i">
<li><p>If we need to merge datasets using row indices, we can use either function.</p></li>
<li><p>If we need to stack datasets one on top of the other, we can only use <code>concat()</code></p></li>
<li><p>If we need to merge datasets using overlapping columns we can only use <code>merge()</code></p></li>
</ol>
</section>
</section>
<section id="reshaping-data-1" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="reshaping-data-1"><span class="header-section-number">8.4</span> Reshaping data</h2>
<p>Data often needs to be re-arranged to ease analysis.</p>
<section id="pivoting-long-to-wide-format" class="level3" data-number="8.4.1">
<h3 data-number="8.4.1" class="anchored" data-anchor-id="pivoting-long-to-wide-format"><span class="header-section-number">8.4.1</span> Pivoting “long” to “wide” format</h3>
<section id="pivot" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="pivot"><a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.pivot.html"><code>pivot()</code></a></h4>
<p>This function helps re-arrange data from the <em>‘long’</em> form to a <em>‘wide’</em> form.</p>
<p><strong>Example:</strong> Let us consider the dataset <code>data_all_continents</code> obtained in the previous section after concatenating the data of all the continents.</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>data_all_continents.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">lifeExp</th>
<th data-quarto-table-cell-role="th">pop</th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Asia</td>
<td>Afghanistan</td>
<td>1952</td>
<td>28.801</td>
<td>8425333</td>
<td>779.445314</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Asia</td>
<td>Afghanistan</td>
<td>1957</td>
<td>30.332</td>
<td>9240934</td>
<td>820.853030</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Asia</td>
<td>Afghanistan</td>
<td>1962</td>
<td>31.997</td>
<td>10267083</td>
<td>853.100710</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Asia</td>
<td>Afghanistan</td>
<td>1967</td>
<td>34.020</td>
<td>11537966</td>
<td>836.197138</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Asia</td>
<td>Afghanistan</td>
<td>1972</td>
<td>36.088</td>
<td>13079460</td>
<td>739.981106</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="pivoting-a-single-column" class="level4" data-number="8.4.1.1">
<h4 data-number="8.4.1.1" class="anchored" data-anchor-id="pivoting-a-single-column"><span class="header-section-number">8.4.1.1</span> Pivoting a single column</h4>
<p>For visualizing life expectancy in 2007 against life expectancy in 1957, we will need to filter the data, and then make the plot. Everytime that we need to compare a metric for a year against another year, we will need to filter the data.</p>
<p>If we need to often compare metrics of a year against another year, it will be easier to have each year as a separate column, instead of having all years in a single column.</p>
<p>As we are increasing the number of columns and decreasing the number of rows, we are re-arranging the data from <em>long</em>-form to <em>wide</em>-form.</p>
<div class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>data_wide <span class="op">=</span> data_all_continents.pivot(index <span class="op">=</span> [<span class="st">'continent'</span>,<span class="st">'country'</span>],columns <span class="op">=</span> <span class="st">'year'</span>,values <span class="op">=</span> <span class="st">'lifeExp'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>data_wide.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">1952</th>
<th data-quarto-table-cell-role="th">1957</th>
<th data-quarto-table-cell-role="th">1962</th>
<th data-quarto-table-cell-role="th">1967</th>
<th data-quarto-table-cell-role="th">1972</th>
<th data-quarto-table-cell-role="th">1977</th>
<th data-quarto-table-cell-role="th">1982</th>
<th data-quarto-table-cell-role="th">1987</th>
<th data-quarto-table-cell-role="th">1992</th>
<th data-quarto-table-cell-role="th">1997</th>
<th data-quarto-table-cell-role="th">2002</th>
<th data-quarto-table-cell-role="th">2007</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Africa</td>
<td data-quarto-table-cell-role="th">Algeria</td>
<td>43.077</td>
<td>45.685</td>
<td>48.303</td>
<td>51.407</td>
<td>54.518</td>
<td>58.014</td>
<td>61.368</td>
<td>65.799</td>
<td>67.744</td>
<td>69.152</td>
<td>70.994</td>
<td>72.301</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>30.015</td>
<td>31.999</td>
<td>34.000</td>
<td>35.985</td>
<td>37.928</td>
<td>39.483</td>
<td>39.942</td>
<td>39.906</td>
<td>40.647</td>
<td>40.963</td>
<td>41.003</td>
<td>42.731</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Benin</td>
<td>38.223</td>
<td>40.358</td>
<td>42.618</td>
<td>44.885</td>
<td>47.014</td>
<td>49.190</td>
<td>50.904</td>
<td>52.337</td>
<td>53.919</td>
<td>54.777</td>
<td>54.406</td>
<td>56.728</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Botswana</td>
<td>47.622</td>
<td>49.618</td>
<td>51.520</td>
<td>53.298</td>
<td>56.024</td>
<td>59.319</td>
<td>61.484</td>
<td>63.622</td>
<td>62.745</td>
<td>52.556</td>
<td>46.634</td>
<td>50.728</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Burkina Faso</td>
<td>31.975</td>
<td>34.906</td>
<td>37.814</td>
<td>40.697</td>
<td>43.591</td>
<td>46.137</td>
<td>48.122</td>
<td>49.557</td>
<td>50.260</td>
<td>50.324</td>
<td>50.650</td>
<td>52.295</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>With values of <code>year</code> as columns, it is easy to compare any metric for different years.</p>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co">#visualizing the change in life expectancy of all countries in 2007 as compared to that in 1957, i.e., the overall change in life expectancy in 50 years. </span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data <span class="op">=</span> data_wide, x <span class="op">=</span> <span class="dv">1957</span>,y<span class="op">=</span><span class="dv">2007</span>,hue <span class="op">=</span> <span class="st">'continent'</span>)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data <span class="op">=</span> data_wide, x <span class="op">=</span> <span class="dv">1957</span>,y <span class="op">=</span> <span class="dv">1957</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>&lt;AxesSubplot:xlabel='1957', ylabel='2007'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Data wrangling_files/figure-html/cell-83-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Observe that for some African countries, the life expectancy has decreased after 50 years. It is worth investigating these countries to identify factors associated with the decrease.</p>
</section>
<section id="pivoting-multiple-columns" class="level4" data-number="8.4.1.2">
<h4 data-number="8.4.1.2" class="anchored" data-anchor-id="pivoting-multiple-columns"><span class="header-section-number">8.4.1.2</span> Pivoting multiple columns</h4>
<p>In the above transformation, we retained only <code>lifeExp</code> in the <em>‘wide’</em> dataset. Suppose, we are also interested in visualizing GDP per capita of countries in one year against another year. In that case, we must have <code>gdpPercap</code> in the <em>’wide</em>’-form data as well.</p>
<p>Let us create a dataset named as <code>data_wide_lifeExp_gdpPercap</code> that will contain both <code>lifeExp</code> and <code>gdpPercap</code> for each year in a separate column. We will specify the columns to pivot in the <em>values</em> argument of the <code>pivot()</code> function.</p>
<div class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>data_wide_lifeExp_gdpPercap <span class="op">=</span> data_all_continents.pivot(index <span class="op">=</span> [<span class="st">'continent'</span>,<span class="st">'country'</span>],columns <span class="op">=</span> <span class="st">'year'</span>,values <span class="op">=</span> [<span class="st">'lifeExp'</span>,<span class="st">'gdpPercap'</span>])</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>data_wide_lifeExp_gdpPercap.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="111">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th colspan="10" data-quarto-table-cell-role="th" data-halign="left">lifeExp</th>
<th data-quarto-table-cell-role="th">...</th>
<th colspan="10" data-quarto-table-cell-role="th" data-halign="left">gdpPercap</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">1952</th>
<th data-quarto-table-cell-role="th">1957</th>
<th data-quarto-table-cell-role="th">1962</th>
<th data-quarto-table-cell-role="th">1967</th>
<th data-quarto-table-cell-role="th">1972</th>
<th data-quarto-table-cell-role="th">1977</th>
<th data-quarto-table-cell-role="th">1982</th>
<th data-quarto-table-cell-role="th">1987</th>
<th data-quarto-table-cell-role="th">1992</th>
<th data-quarto-table-cell-role="th">1997</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">1962</th>
<th data-quarto-table-cell-role="th">1967</th>
<th data-quarto-table-cell-role="th">1972</th>
<th data-quarto-table-cell-role="th">1977</th>
<th data-quarto-table-cell-role="th">1982</th>
<th data-quarto-table-cell-role="th">1987</th>
<th data-quarto-table-cell-role="th">1992</th>
<th data-quarto-table-cell-role="th">1997</th>
<th data-quarto-table-cell-role="th">2002</th>
<th data-quarto-table-cell-role="th">2007</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Africa</td>
<td data-quarto-table-cell-role="th">Algeria</td>
<td>43.077</td>
<td>45.685</td>
<td>48.303</td>
<td>51.407</td>
<td>54.518</td>
<td>58.014</td>
<td>61.368</td>
<td>65.799</td>
<td>67.744</td>
<td>69.152</td>
<td>...</td>
<td>2550.816880</td>
<td>3246.991771</td>
<td>4182.663766</td>
<td>4910.416756</td>
<td>5745.160213</td>
<td>5681.358539</td>
<td>5023.216647</td>
<td>4797.295051</td>
<td>5288.040382</td>
<td>6223.367465</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>30.015</td>
<td>31.999</td>
<td>34.000</td>
<td>35.985</td>
<td>37.928</td>
<td>39.483</td>
<td>39.942</td>
<td>39.906</td>
<td>40.647</td>
<td>40.963</td>
<td>...</td>
<td>4269.276742</td>
<td>5522.776375</td>
<td>5473.288005</td>
<td>3008.647355</td>
<td>2756.953672</td>
<td>2430.208311</td>
<td>2627.845685</td>
<td>2277.140884</td>
<td>2773.287312</td>
<td>4797.231267</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Benin</td>
<td>38.223</td>
<td>40.358</td>
<td>42.618</td>
<td>44.885</td>
<td>47.014</td>
<td>49.190</td>
<td>50.904</td>
<td>52.337</td>
<td>53.919</td>
<td>54.777</td>
<td>...</td>
<td>949.499064</td>
<td>1035.831411</td>
<td>1085.796879</td>
<td>1029.161251</td>
<td>1277.897616</td>
<td>1225.856010</td>
<td>1191.207681</td>
<td>1232.975292</td>
<td>1372.877931</td>
<td>1441.284873</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Botswana</td>
<td>47.622</td>
<td>49.618</td>
<td>51.520</td>
<td>53.298</td>
<td>56.024</td>
<td>59.319</td>
<td>61.484</td>
<td>63.622</td>
<td>62.745</td>
<td>52.556</td>
<td>...</td>
<td>983.653976</td>
<td>1214.709294</td>
<td>2263.611114</td>
<td>3214.857818</td>
<td>4551.142150</td>
<td>6205.883850</td>
<td>7954.111645</td>
<td>8647.142313</td>
<td>11003.605080</td>
<td>12569.851770</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Burkina Faso</td>
<td>31.975</td>
<td>34.906</td>
<td>37.814</td>
<td>40.697</td>
<td>43.591</td>
<td>46.137</td>
<td>48.122</td>
<td>49.557</td>
<td>50.260</td>
<td>50.324</td>
<td>...</td>
<td>722.512021</td>
<td>794.826560</td>
<td>854.735976</td>
<td>743.387037</td>
<td>807.198586</td>
<td>912.063142</td>
<td>931.752773</td>
<td>946.294962</td>
<td>1037.645221</td>
<td>1217.032994</td>
</tr>
</tbody>
</table>

<p>5 rows × 24 columns</p>
</div>
</div>
</div>
<p>The metric for each year is now in a separate column, and can be visualized directly. Note that re-arranging the dataset from the <em>‘long’</em>-form to <em>‘wide-form’</em> leads to hierarchical indexing of columns when multiple <em>‘values’</em> need to be re-arranged. In this case, the multiple <em>‘values’</em> that need to be re-arranged are <code>lifeExp</code> and <code>gdpPercap</code>.</p>
</section>
</section>
<section id="melting-wide-to-long-format" class="level3" data-number="8.4.2">
<h3 data-number="8.4.2" class="anchored" data-anchor-id="melting-wide-to-long-format"><span class="header-section-number">8.4.2</span> Melting “wide” to “long” format</h3>
<section id="melt" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="melt"><a href="https://pandas.pydata.org/docs/reference/api/pandas.melt.html"><code>melt()</code></a></h4>
<p>This function is used to re-arrange the dataset from the <em>‘wide’</em> form to the <em>‘long’</em> form.</p>
</section>
<section id="melting-columns-with-a-single-type-of-value" class="level4" data-number="8.4.2.1">
<h4 data-number="8.4.2.1" class="anchored" data-anchor-id="melting-columns-with-a-single-type-of-value"><span class="header-section-number">8.4.2.1</span> Melting columns with a single type of value</h4>
<p>Let us consider <code>data_wide</code> created in the previous section.</p>
<div class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>data_wide.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="114">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">1952</th>
<th data-quarto-table-cell-role="th">1957</th>
<th data-quarto-table-cell-role="th">1962</th>
<th data-quarto-table-cell-role="th">1967</th>
<th data-quarto-table-cell-role="th">1972</th>
<th data-quarto-table-cell-role="th">1977</th>
<th data-quarto-table-cell-role="th">1982</th>
<th data-quarto-table-cell-role="th">1987</th>
<th data-quarto-table-cell-role="th">1992</th>
<th data-quarto-table-cell-role="th">1997</th>
<th data-quarto-table-cell-role="th">2002</th>
<th data-quarto-table-cell-role="th">2007</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Africa</td>
<td data-quarto-table-cell-role="th">Algeria</td>
<td>43.077</td>
<td>45.685</td>
<td>48.303</td>
<td>51.407</td>
<td>54.518</td>
<td>58.014</td>
<td>61.368</td>
<td>65.799</td>
<td>67.744</td>
<td>69.152</td>
<td>70.994</td>
<td>72.301</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>30.015</td>
<td>31.999</td>
<td>34.000</td>
<td>35.985</td>
<td>37.928</td>
<td>39.483</td>
<td>39.942</td>
<td>39.906</td>
<td>40.647</td>
<td>40.963</td>
<td>41.003</td>
<td>42.731</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Benin</td>
<td>38.223</td>
<td>40.358</td>
<td>42.618</td>
<td>44.885</td>
<td>47.014</td>
<td>49.190</td>
<td>50.904</td>
<td>52.337</td>
<td>53.919</td>
<td>54.777</td>
<td>54.406</td>
<td>56.728</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Botswana</td>
<td>47.622</td>
<td>49.618</td>
<td>51.520</td>
<td>53.298</td>
<td>56.024</td>
<td>59.319</td>
<td>61.484</td>
<td>63.622</td>
<td>62.745</td>
<td>52.556</td>
<td>46.634</td>
<td>50.728</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Burkina Faso</td>
<td>31.975</td>
<td>34.906</td>
<td>37.814</td>
<td>40.697</td>
<td>43.591</td>
<td>46.137</td>
<td>48.122</td>
<td>49.557</td>
<td>50.260</td>
<td>50.324</td>
<td>50.650</td>
<td>52.295</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Suppose, we wish to visualize the change of life expectancy over time for different continents, as we did in section <a href="https://nustat.github.io/DataScience_Intro_python/Data%20wrangling.html#concatenating-datasets">8.3</a>. For plotting <code>lifeExp</code> against <code>year</code>, all the years must be in a single column. Thus, we need to <em>melt</em> the columns of <code>data_wide</code> to a single column and call it <code>year</code>.</p>
<p>But before melting the columns in the above dataset, we will convert <code>continent</code> to a column, as we need to make subplots based on continent.</p>
<p>The Pandas DataFrame method <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.reset_index.html"><code>reset_index()</code></a> can be used to remove one or more levels of indexing from the DataFrame.</p>
<div class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Making 'continent' a column instead of row-index at level 0</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>data_wide.reset_index(inplace<span class="op">=</span><span class="va">True</span>,level<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>data_wide.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="94">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">1952</th>
<th data-quarto-table-cell-role="th">1957</th>
<th data-quarto-table-cell-role="th">1962</th>
<th data-quarto-table-cell-role="th">1967</th>
<th data-quarto-table-cell-role="th">1972</th>
<th data-quarto-table-cell-role="th">1977</th>
<th data-quarto-table-cell-role="th">1982</th>
<th data-quarto-table-cell-role="th">1987</th>
<th data-quarto-table-cell-role="th">1992</th>
<th data-quarto-table-cell-role="th">1997</th>
<th data-quarto-table-cell-role="th">2002</th>
<th data-quarto-table-cell-role="th">2007</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Algeria</td>
<td>Africa</td>
<td>43.077</td>
<td>45.685</td>
<td>48.303</td>
<td>51.407</td>
<td>54.518</td>
<td>58.014</td>
<td>61.368</td>
<td>65.799</td>
<td>67.744</td>
<td>69.152</td>
<td>70.994</td>
<td>72.301</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>Africa</td>
<td>30.015</td>
<td>31.999</td>
<td>34.000</td>
<td>35.985</td>
<td>37.928</td>
<td>39.483</td>
<td>39.942</td>
<td>39.906</td>
<td>40.647</td>
<td>40.963</td>
<td>41.003</td>
<td>42.731</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Benin</td>
<td>Africa</td>
<td>38.223</td>
<td>40.358</td>
<td>42.618</td>
<td>44.885</td>
<td>47.014</td>
<td>49.190</td>
<td>50.904</td>
<td>52.337</td>
<td>53.919</td>
<td>54.777</td>
<td>54.406</td>
<td>56.728</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Botswana</td>
<td>Africa</td>
<td>47.622</td>
<td>49.618</td>
<td>51.520</td>
<td>53.298</td>
<td>56.024</td>
<td>59.319</td>
<td>61.484</td>
<td>63.622</td>
<td>62.745</td>
<td>52.556</td>
<td>46.634</td>
<td>50.728</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Burkina Faso</td>
<td>Africa</td>
<td>31.975</td>
<td>34.906</td>
<td>37.814</td>
<td>40.697</td>
<td>43.591</td>
<td>46.137</td>
<td>48.122</td>
<td>49.557</td>
<td>50.260</td>
<td>50.324</td>
<td>50.650</td>
<td>52.295</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>data_melted<span class="op">=</span>pd.melt(data_wide,id_vars <span class="op">=</span> [<span class="st">'continent'</span>],var_name <span class="op">=</span> <span class="st">'Year'</span>,value_name <span class="op">=</span> <span class="st">'LifeExp'</span>)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>data_melted.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="96">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">LifeExp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Africa</td>
<td>1952</td>
<td>43.077</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Africa</td>
<td>1952</td>
<td>30.015</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Africa</td>
<td>1952</td>
<td>38.223</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Africa</td>
<td>1952</td>
<td>47.622</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Africa</td>
<td>1952</td>
<td>31.975</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>With the above DataFrame, we can visualize the mean life expectancy against year separately for each continent.</p>
<p>If we wish to have country also in the above data, we can keep it while resetting the index:</p>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating 'data_wide' again</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>data_wide <span class="op">=</span> data_all_continents.pivot(index <span class="op">=</span> [<span class="st">'continent'</span>,<span class="st">'country'</span>],columns <span class="op">=</span> <span class="st">'year'</span>,values <span class="op">=</span> <span class="st">'lifeExp'</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Resetting the row-indices to default values</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>data_wide.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>data_wide.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">1952</th>
<th data-quarto-table-cell-role="th">1957</th>
<th data-quarto-table-cell-role="th">1962</th>
<th data-quarto-table-cell-role="th">1967</th>
<th data-quarto-table-cell-role="th">1972</th>
<th data-quarto-table-cell-role="th">1977</th>
<th data-quarto-table-cell-role="th">1982</th>
<th data-quarto-table-cell-role="th">1987</th>
<th data-quarto-table-cell-role="th">1992</th>
<th data-quarto-table-cell-role="th">1997</th>
<th data-quarto-table-cell-role="th">2002</th>
<th data-quarto-table-cell-role="th">2007</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Africa</td>
<td>Algeria</td>
<td>43.077</td>
<td>45.685</td>
<td>48.303</td>
<td>51.407</td>
<td>54.518</td>
<td>58.014</td>
<td>61.368</td>
<td>65.799</td>
<td>67.744</td>
<td>69.152</td>
<td>70.994</td>
<td>72.301</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Africa</td>
<td>Angola</td>
<td>30.015</td>
<td>31.999</td>
<td>34.000</td>
<td>35.985</td>
<td>37.928</td>
<td>39.483</td>
<td>39.942</td>
<td>39.906</td>
<td>40.647</td>
<td>40.963</td>
<td>41.003</td>
<td>42.731</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Africa</td>
<td>Benin</td>
<td>38.223</td>
<td>40.358</td>
<td>42.618</td>
<td>44.885</td>
<td>47.014</td>
<td>49.190</td>
<td>50.904</td>
<td>52.337</td>
<td>53.919</td>
<td>54.777</td>
<td>54.406</td>
<td>56.728</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Africa</td>
<td>Botswana</td>
<td>47.622</td>
<td>49.618</td>
<td>51.520</td>
<td>53.298</td>
<td>56.024</td>
<td>59.319</td>
<td>61.484</td>
<td>63.622</td>
<td>62.745</td>
<td>52.556</td>
<td>46.634</td>
<td>50.728</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Africa</td>
<td>Burkina Faso</td>
<td>31.975</td>
<td>34.906</td>
<td>37.814</td>
<td>40.697</td>
<td>43.591</td>
<td>46.137</td>
<td>48.122</td>
<td>49.557</td>
<td>50.260</td>
<td>50.324</td>
<td>50.650</td>
<td>52.295</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Melting the 'year' column</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>data_melted<span class="op">=</span>pd.melt(data_wide,id_vars <span class="op">=</span> [<span class="st">'continent'</span>,<span class="st">'country'</span>],var_name <span class="op">=</span> <span class="st">'Year'</span>,value_name <span class="op">=</span> <span class="st">'LifeExp'</span>)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>data_melted.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="106">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">LifeExp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Africa</td>
<td>Algeria</td>
<td>1952</td>
<td>43.077</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Africa</td>
<td>Angola</td>
<td>1952</td>
<td>30.015</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Africa</td>
<td>Benin</td>
<td>1952</td>
<td>38.223</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Africa</td>
<td>Botswana</td>
<td>1952</td>
<td>47.622</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Africa</td>
<td>Burkina Faso</td>
<td>1952</td>
<td>31.975</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="melting-columns-with-multiple-types-of-values" class="level4" data-number="8.4.2.2">
<h4 data-number="8.4.2.2" class="anchored" data-anchor-id="melting-columns-with-multiple-types-of-values"><span class="header-section-number">8.4.2.2</span> Melting columns with multiple types of values</h4>
<p>Consider the dataset created in Section <a href="https://nustat.github.io/DataScience_Intro_python/Data%20wrangling.html#pivoting-multiple-columns">8.4.1.2</a>. It has two types of values - <code>lifeExp</code> and <code>gdpPercapita</code>, which are the column labels at the outer level. The <code>melt()</code> function will melt all the years of data into a single column. However, it will create another column based on the outer level column labels - <code>lifeExp</code> and <code>gdpPercapita</code> to distinguish between these two types of values. Here, we see that the function <code>melt()</code> internally uses hierarchical indexing to handle the transformation of multiple types of columns.</p>
<div class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>data_melt <span class="op">=</span> pd.melt(data_wide_lifeExp_gdpPercap.reset_index(),id_vars <span class="op">=</span> [<span class="st">'continent'</span>,<span class="st">'country'</span>],var_name <span class="op">=</span> [<span class="st">'Metric'</span>,<span class="st">'year'</span>])</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>data_melt.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="121">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">Metric</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Africa</td>
<td>Algeria</td>
<td>lifeExp</td>
<td>1952</td>
<td>43.077</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Africa</td>
<td>Angola</td>
<td>lifeExp</td>
<td>1952</td>
<td>30.015</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Africa</td>
<td>Benin</td>
<td>lifeExp</td>
<td>1952</td>
<td>38.223</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Africa</td>
<td>Botswana</td>
<td>lifeExp</td>
<td>1952</td>
<td>47.622</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Africa</td>
<td>Burkina Faso</td>
<td>lifeExp</td>
<td>1952</td>
<td>31.975</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Although the data above is in <em>‘long’</em>-form, it is not quiet in its original format, as in <code>data_all_continents</code>. We need to pivot again by <code>Metric</code> to have two separate columns of <code>gdpPercap</code> and <code>lifeExp</code>.</p>
<div class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>data_restore <span class="op">=</span> data_melt.pivot(index <span class="op">=</span> [<span class="st">'continent'</span>,<span class="st">'country'</span>,<span class="st">'year'</span>],columns <span class="op">=</span> <span class="st">'Metric'</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>data_restore.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="122">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">value</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Metric</th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
<th data-quarto-table-cell-role="th">lifeExp</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Africa</td>
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Algeria</td>
<td data-quarto-table-cell-role="th">1952</td>
<td>2449.008185</td>
<td>43.077</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1957</td>
<td>3013.976023</td>
<td>45.685</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1962</td>
<td>2550.816880</td>
<td>48.303</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1967</td>
<td>3246.991771</td>
<td>51.407</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1972</td>
<td>4182.663766</td>
<td>54.518</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now, we can convert the row indices of <code>continent</code> and <code>country</code> to columns to restore the dataset to the same form as <code>data_all_continents</code>.</p>
<div class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>data_restore.reset_index(inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>data_restore.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="123">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">value</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Metric</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
<th data-quarto-table-cell-role="th">lifeExp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Africa</td>
<td>Algeria</td>
<td>1952</td>
<td>2449.008185</td>
<td>43.077</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Africa</td>
<td>Algeria</td>
<td>1957</td>
<td>3013.976023</td>
<td>45.685</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Africa</td>
<td>Algeria</td>
<td>1962</td>
<td>2550.816880</td>
<td>48.303</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Africa</td>
<td>Algeria</td>
<td>1967</td>
<td>3246.991771</td>
<td>51.407</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Africa</td>
<td>Algeria</td>
<td>1972</td>
<td>4182.663766</td>
<td>54.518</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="practice-exercise-5" class="level3" data-number="8.4.3">
<h3 data-number="8.4.3" class="anchored" data-anchor-id="practice-exercise-5"><span class="header-section-number">8.4.3</span> Practice exercise 5</h3>
<section id="section-8" class="level4" data-number="8.4.3.1">
<h4 data-number="8.4.3.1" class="anchored" data-anchor-id="section-8"><span class="header-section-number">8.4.3.1</span> </h4>
<p>Both <code>unstack()</code> and <code>pivot()</code> seem to transform the data from the <em>‘long’</em> form to the <em>‘wide’</em> form. Is there a difference between the two functions?</p>
<p><strong>Solution:</strong></p>
<p>Yes, both the functions transform the data from the <em>‘long’</em> form to the <em>‘wide’</em> form. However, <code>unstack()</code> pivots the row indices, while <code>pivot()</code> pivots the columns of the DataFrame.</p>
<p>Even though both functions are a bit different, it is possible to just use one of them to perform a reshaping operation. If we wish to pivot a column, we can either use <code>pivot()</code> directly on the column, or we can convert the column to row indices and then use <code>unstack()</code>. If we wish to pivot row indices, we can either use <code>unstack()</code> directly on the row indices, or we can convert row indices to a column and then use <code>pivot()</code>.</p>
<p>To summarise, using one function may be more straightforward than using the other one, but either can be used for reshaping data from the <em>‘long’</em> form to the <em>‘wide’</em> form.</p>
<p>Below is an example where we perform the same reshaping operation with either function.</p>
<p>Consider the data <code>data_all_continent</code>. Suppose we wish to transform it to <code>data_wide</code> as we did using <code>pivot()</code> in Section <a href="https://nustat.github.io/DataScience_Intro_python/Data%20wrangling.html#pivoting-a-single-column">8.4.1.1</a>. Let us do it using <code>unstack()</code>, instead of <code>pivot()</code>.</p>
<p>The first step will be to reindex data to set <code>year</code> as row indices, and also <code>continent</code> and <code>country</code> as row indices because these two column were set as indices with the <code>pivot()</code> function in Section <a href="https://nustat.github.io/DataScience_Intro_python/Data%20wrangling.html#pivoting-a-single-column">8.4.1.1</a>.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Reindexing data to make 'continent', 'country', and 'year' as hierarchical row indices</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>data_reindexed<span class="op">=</span>data_all_continents.set_index([<span class="st">'continent'</span>,<span class="st">'country'</span>,<span class="st">'year'</span>])</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>data_reindexed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">lifeExp</th>
<th data-quarto-table-cell-role="th">pop</th>
<th data-quarto-table-cell-role="th">gdpPercap</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Asia</td>
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Afghanistan</td>
<td data-quarto-table-cell-role="th">1952</td>
<td>28.801</td>
<td>8425333</td>
<td>779.445314</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1957</td>
<td>30.332</td>
<td>9240934</td>
<td>820.853030</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1962</td>
<td>31.997</td>
<td>10267083</td>
<td>853.100710</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1967</td>
<td>34.020</td>
<td>11537966</td>
<td>836.197138</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1972</td>
<td>36.088</td>
<td>13079460</td>
<td>739.981106</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Americas</td>
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Venezuela</td>
<td data-quarto-table-cell-role="th">1987</td>
<td>70.190</td>
<td>17910182</td>
<td>9883.584648</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1992</td>
<td>71.150</td>
<td>20265563</td>
<td>10733.926310</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1997</td>
<td>72.146</td>
<td>22374398</td>
<td>10165.495180</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2002</td>
<td>72.766</td>
<td>24287670</td>
<td>8605.047831</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2007</td>
<td>73.747</td>
<td>26084662</td>
<td>11415.805690</td>
</tr>
</tbody>
</table>

<p>1704 rows × 3 columns</p>
</div>
</div>
</div>
<p>Now we can use <code>unstack()</code> to pivot the desired row index, i.e., <code>year</code>. Also, since we are only interested in pivoting the values of <code>lifeExp</code> (as in the example in Section <a href="https://nustat.github.io/DataScience_Intro_python/Data%20wrangling.html#pivoting-a-single-column">8.4.1.1</a>), we will filter the pivoted data with the <code>lifeExp</code> column label.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>data_wide_with_unstack<span class="op">=</span>data_reindexed.unstack(<span class="st">'year'</span>)[<span class="st">'lifeExp'</span>]</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>data_wide_with_unstack</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">1952</th>
<th data-quarto-table-cell-role="th">1957</th>
<th data-quarto-table-cell-role="th">1962</th>
<th data-quarto-table-cell-role="th">1967</th>
<th data-quarto-table-cell-role="th">1972</th>
<th data-quarto-table-cell-role="th">1977</th>
<th data-quarto-table-cell-role="th">1982</th>
<th data-quarto-table-cell-role="th">1987</th>
<th data-quarto-table-cell-role="th">1992</th>
<th data-quarto-table-cell-role="th">1997</th>
<th data-quarto-table-cell-role="th">2002</th>
<th data-quarto-table-cell-role="th">2007</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="5" data-quarto-table-cell-role="th" data-valign="top">Africa</td>
<td data-quarto-table-cell-role="th">Algeria</td>
<td>43.077</td>
<td>45.685</td>
<td>48.303</td>
<td>51.407</td>
<td>54.518</td>
<td>58.014</td>
<td>61.368</td>
<td>65.799</td>
<td>67.744</td>
<td>69.152</td>
<td>70.994</td>
<td>72.301</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Angola</td>
<td>30.015</td>
<td>31.999</td>
<td>34.000</td>
<td>35.985</td>
<td>37.928</td>
<td>39.483</td>
<td>39.942</td>
<td>39.906</td>
<td>40.647</td>
<td>40.963</td>
<td>41.003</td>
<td>42.731</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Benin</td>
<td>38.223</td>
<td>40.358</td>
<td>42.618</td>
<td>44.885</td>
<td>47.014</td>
<td>49.190</td>
<td>50.904</td>
<td>52.337</td>
<td>53.919</td>
<td>54.777</td>
<td>54.406</td>
<td>56.728</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Botswana</td>
<td>47.622</td>
<td>49.618</td>
<td>51.520</td>
<td>53.298</td>
<td>56.024</td>
<td>59.319</td>
<td>61.484</td>
<td>63.622</td>
<td>62.745</td>
<td>52.556</td>
<td>46.634</td>
<td>50.728</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Burkina Faso</td>
<td>31.975</td>
<td>34.906</td>
<td>37.814</td>
<td>40.697</td>
<td>43.591</td>
<td>46.137</td>
<td>48.122</td>
<td>49.557</td>
<td>50.260</td>
<td>50.324</td>
<td>50.650</td>
<td>52.295</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td rowspan="3" data-quarto-table-cell-role="th" data-valign="top">Europe</td>
<td data-quarto-table-cell-role="th">Switzerland</td>
<td>69.620</td>
<td>70.560</td>
<td>71.320</td>
<td>72.770</td>
<td>73.780</td>
<td>75.390</td>
<td>76.210</td>
<td>77.410</td>
<td>78.030</td>
<td>79.370</td>
<td>80.620</td>
<td>81.701</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Turkey</td>
<td>43.585</td>
<td>48.079</td>
<td>52.098</td>
<td>54.336</td>
<td>57.005</td>
<td>59.507</td>
<td>61.036</td>
<td>63.108</td>
<td>66.146</td>
<td>68.835</td>
<td>70.845</td>
<td>71.777</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">United Kingdom</td>
<td>69.180</td>
<td>70.420</td>
<td>70.760</td>
<td>71.360</td>
<td>72.010</td>
<td>72.760</td>
<td>74.040</td>
<td>75.007</td>
<td>76.420</td>
<td>77.218</td>
<td>78.471</td>
<td>79.425</td>
</tr>
<tr class="even">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Oceania</td>
<td data-quarto-table-cell-role="th">Australia</td>
<td>69.120</td>
<td>70.330</td>
<td>70.930</td>
<td>71.100</td>
<td>71.930</td>
<td>73.490</td>
<td>74.740</td>
<td>76.320</td>
<td>77.560</td>
<td>78.830</td>
<td>80.370</td>
<td>81.235</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">New Zealand</td>
<td>69.390</td>
<td>70.260</td>
<td>71.240</td>
<td>71.520</td>
<td>71.890</td>
<td>72.220</td>
<td>73.840</td>
<td>74.320</td>
<td>76.330</td>
<td>77.550</td>
<td>79.110</td>
<td>80.204</td>
</tr>
</tbody>
</table>

<p>142 rows × 12 columns</p>
</div>
</div>
</div>
<p>The above dataset is the same as that obtained using the <code>pivot()</code> function in Section <a href="https://nustat.github.io/DataScience_Intro_python/Data%20wrangling.html#pivoting-a-single-column">8.4.1.1</a>.</p>
</section>
<section id="section-9" class="level4" data-number="8.4.3.2">
<h4 data-number="8.4.3.2" class="anchored" data-anchor-id="section-9"><span class="header-section-number">8.4.3.2</span> </h4>
<p>Both <code>stack()</code> and <code>melt()</code> seem to transform the data from the <em>‘wide’</em> form to the <em>‘long’</em> form. Is there a difference between the two functions?</p>
<p><strong>Solution:</strong></p>
<p>Following the trend of the previous question, we can always use <code>stack()</code> instead of <code>melt()</code> and vice-versa. The main difference is that <code>melt()</code> lets us choose the indentifier columns with the argument <code>id_vars</code>. However, if we use <code>stack()</code>, we will need to set the relevant melted row indices as columns. On the other hand, if we wished to have the melted columns as row indices, we can either directly use <code>stack()</code> or use <code>melt()</code> and then set the desired columns as row indices.</p>
<p>To summarise, using one function may be more straightforward than using the other one, but either can be used for reshaping data from the <em>‘wide’</em> form to the <em>‘long’</em> form.</p>
<p>Let us melt the data <code>data_wide_with_unstack</code> using the <code>stack()</code> function to obtain the same dataset as obtained with the <code>melt()</code> function in Section <a href="https://nustat.github.io/DataScience_Intro_python/Data%20wrangling.html#melting-columns-with-a-single-type-of-value">8.4.1.2</a>.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Stacking the data</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>data_stacked <span class="op">=</span> data_wide_with_unstack.stack()</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>data_stacked</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>continent  country      year
Africa     Algeria      1952    43.077
                        1957    45.685
                        1962    48.303
                        1967    51.407
                        1972    54.518
                                 ...  
Oceania    New Zealand  1987    74.320
                        1992    76.330
                        1997    77.550
                        2002    79.110
                        2007    80.204
Length: 1704, dtype: float64</code></pre>
</div>
</div>
<p>Now we need to convert the row indices <code>continent</code> and <code>country</code> to columns as in the melted data in Section <a href="https://nustat.github.io/DataScience_Intro_python/Data%20wrangling.html#melting-columns-with-a-single-type-of-value">8.4.1.2</a>.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Putting 'continent' and 'country' as columns</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>data_long_with_stack <span class="op">=</span> data_stacked.reset_index()</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>data_long_with_stack</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">0</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Africa</td>
<td>Algeria</td>
<td>1952</td>
<td>43.077</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Africa</td>
<td>Algeria</td>
<td>1957</td>
<td>45.685</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Africa</td>
<td>Algeria</td>
<td>1962</td>
<td>48.303</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Africa</td>
<td>Algeria</td>
<td>1967</td>
<td>51.407</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Africa</td>
<td>Algeria</td>
<td>1972</td>
<td>54.518</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1699</td>
<td>Oceania</td>
<td>New Zealand</td>
<td>1987</td>
<td>74.320</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1700</td>
<td>Oceania</td>
<td>New Zealand</td>
<td>1992</td>
<td>76.330</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1701</td>
<td>Oceania</td>
<td>New Zealand</td>
<td>1997</td>
<td>77.550</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1702</td>
<td>Oceania</td>
<td>New Zealand</td>
<td>2002</td>
<td>79.110</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1703</td>
<td>Oceania</td>
<td>New Zealand</td>
<td>2007</td>
<td>80.204</td>
</tr>
</tbody>
</table>

<p>1704 rows × 4 columns</p>
</div>
</div>
</div>
<p>Finally, we need to rename the column named as 0 to <code>LifeExp</code> to obtain the same dataset as in Section <a href="https://nustat.github.io/DataScience_Intro_python/Data%20wrangling.html#melting-columns-with-a-single-type-of-value">8.4.1.2</a>.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Renaming column 0 to 'LifeExp'</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>data_long_with_stack.rename(columns <span class="op">=</span> {<span class="dv">0</span>:<span class="st">'LifeExp'</span>},inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>data_long_with_stack</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">continent</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">LifeExp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Africa</td>
<td>Algeria</td>
<td>1952</td>
<td>43.077</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Africa</td>
<td>Algeria</td>
<td>1957</td>
<td>45.685</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Africa</td>
<td>Algeria</td>
<td>1962</td>
<td>48.303</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Africa</td>
<td>Algeria</td>
<td>1967</td>
<td>51.407</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Africa</td>
<td>Algeria</td>
<td>1972</td>
<td>54.518</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1699</td>
<td>Oceania</td>
<td>New Zealand</td>
<td>1987</td>
<td>74.320</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1700</td>
<td>Oceania</td>
<td>New Zealand</td>
<td>1992</td>
<td>76.330</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1701</td>
<td>Oceania</td>
<td>New Zealand</td>
<td>1997</td>
<td>77.550</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1702</td>
<td>Oceania</td>
<td>New Zealand</td>
<td>2002</td>
<td>79.110</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1703</td>
<td>Oceania</td>
<td>New Zealand</td>
<td>2007</td>
<td>80.204</td>
</tr>
</tbody>
</table>

<p>1704 rows × 4 columns</p>
</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Data cleaning and preparation.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data cleaning and preparation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Data aggregation.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data aggregation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>
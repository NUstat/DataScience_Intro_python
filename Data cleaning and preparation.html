<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction to Data Science with Python - 7&nbsp; Data cleaning and preparation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Data wrangling.html" rel="next">
<link href="./Data visualization.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Reading data.html">Exploratory data analysis</a></li><li class="breadcrumb-item"><a href="./Data cleaning and preparation.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data cleaning and preparation</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./NU_Stat_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Data Science with Python</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Quick overview: Python programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Introduction to Python and Jupyter Notebooks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Python and Jupyter Notebooks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_structures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data structures</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Exploratory data analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Reading data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Reading data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./NumPy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">NumPy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Pandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Pandas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data cleaning and preparation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data cleaning and preparation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data wrangling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Data aggregation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data aggregation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./student_solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Alternative solutions by students</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Datasets &amp; Templates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#handling-missing-data" id="toc-handling-missing-data" class="nav-link active" data-scroll-target="#handling-missing-data"><span class="header-section-number">7.1</span> Handling missing data</a>
  <ul>
  <li><a href="#identifying-missing-values-isnull" id="toc-identifying-missing-values-isnull" class="nav-link" data-scroll-target="#identifying-missing-values-isnull"><span class="header-section-number">7.1.1</span> Identifying missing values (<code>isnull()</code>)</a></li>
  <li><a href="#types-of-missing-values" id="toc-types-of-missing-values" class="nav-link" data-scroll-target="#types-of-missing-values"><span class="header-section-number">7.1.2</span> Types of missing values</a>
  <ul class="collapse">
  <li><a href="#missing-completely-at-random-mcar" id="toc-missing-completely-at-random-mcar" class="nav-link" data-scroll-target="#missing-completely-at-random-mcar"><span class="header-section-number">7.1.2.1</span> Missing Completely at Random (MCAR)</a></li>
  <li><a href="#missing-at-random-mar" id="toc-missing-at-random-mar" class="nav-link" data-scroll-target="#missing-at-random-mar"><span class="header-section-number">7.1.2.2</span> Missing at Random (MAR)</a></li>
  <li><a href="#missing-not-at-random-mnar" id="toc-missing-not-at-random-mnar" class="nav-link" data-scroll-target="#missing-not-at-random-mnar"><span class="header-section-number">7.1.2.3</span> Missing Not at Random (MNAR)</a></li>
  </ul></li>
  <li><a href="#practice-exercise-1" id="toc-practice-exercise-1" class="nav-link" data-scroll-target="#practice-exercise-1"><span class="header-section-number">7.1.3</span> Practice exercise 1</a>
  <ul class="collapse">
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="header-section-number">7.1.3.1</span> </a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"><span class="header-section-number">7.1.3.2</span> </a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"><span class="header-section-number">7.1.3.3</span> </a></li>
  </ul></li>
  <li><a href="#dropping-observations-with-missing-values-dropna" id="toc-dropping-observations-with-missing-values-dropna" class="nav-link" data-scroll-target="#dropping-observations-with-missing-values-dropna"><span class="header-section-number">7.1.4</span> Dropping observations with missing values (<code>dropna()</code>)</a></li>
  <li><a href="#some-methods-to-impute-missing-values" id="toc-some-methods-to-impute-missing-values" class="nav-link" data-scroll-target="#some-methods-to-impute-missing-values"><span class="header-section-number">7.1.5</span> Some methods to impute missing values</a>
  <ul class="collapse">
  <li><a href="#method-1-naive-method" id="toc-method-1-naive-method" class="nav-link" data-scroll-target="#method-1-naive-method"><span class="header-section-number">7.1.5.1</span> Method 1: Naive Method</a></li>
  <li><a href="#method-2-imputing-missing-values-as-the-mean-of-non-missing-values" id="toc-method-2-imputing-missing-values-as-the-mean-of-non-missing-values" class="nav-link" data-scroll-target="#method-2-imputing-missing-values-as-the-mean-of-non-missing-values"><span class="header-section-number">7.1.5.2</span> Method 2: Imputing missing values as the mean of non-missing values</a></li>
  <li><a href="#method-3-imputing-missing-values-based-on-correlated-variables-in-the-data" id="toc-method-3-imputing-missing-values-based-on-correlated-variables-in-the-data" class="nav-link" data-scroll-target="#method-3-imputing-missing-values-based-on-correlated-variables-in-the-data"><span class="header-section-number">7.1.5.3</span> Method 3: Imputing missing values based on correlated variables in the data</a></li>
  <li><a href="#practice-exercise-2" id="toc-practice-exercise-2" class="nav-link" data-scroll-target="#practice-exercise-2"><span class="header-section-number">7.1.5.4</span> Practice exercise 2</a></li>
  <li><a href="#method-4-knn-k-nearest-neighbor" id="toc-method-4-knn-k-nearest-neighbor" class="nav-link" data-scroll-target="#method-4-knn-k-nearest-neighbor"><span class="header-section-number">7.1.5.5</span> Method 4: KNN: K-nearest neighbor</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#data-binning" id="toc-data-binning" class="nav-link" data-scroll-target="#data-binning"><span class="header-section-number">7.2</span> Data binning</a>
  <ul>
  <li><a href="#binning-with-equal-width-bins" id="toc-binning-with-equal-width-bins" class="nav-link" data-scroll-target="#binning-with-equal-width-bins"><span class="header-section-number">7.2.1</span> Binning with equal width bins</a></li>
  <li><a href="#binning-with-equal-sized-bins" id="toc-binning-with-equal-sized-bins" class="nav-link" data-scroll-target="#binning-with-equal-sized-bins"><span class="header-section-number">7.2.2</span> Binning with equal sized bins</a></li>
  <li><a href="#binning-with-custom-bins" id="toc-binning-with-custom-bins" class="nav-link" data-scroll-target="#binning-with-custom-bins"><span class="header-section-number">7.2.3</span> Binning with custom bins</a></li>
  </ul></li>
  <li><a href="#dummy-indicator-variables" id="toc-dummy-indicator-variables" class="nav-link" data-scroll-target="#dummy-indicator-variables"><span class="header-section-number">7.3</span> Dummy / Indicator variables</a>
  <ul>
  <li><a href="#practice-exercise-3" id="toc-practice-exercise-3" class="nav-link" data-scroll-target="#practice-exercise-3"><span class="header-section-number">7.3.1</span> Practice exercise 3</a></li>
  </ul></li>
  <li><a href="#outlier-detection" id="toc-outlier-detection" class="nav-link" data-scroll-target="#outlier-detection"><span class="header-section-number">7.4</span> Outlier detection</a>
  <ul>
  <li><a href="#practice-exercise-4" id="toc-practice-exercise-4" class="nav-link" data-scroll-target="#practice-exercise-4"><span class="header-section-number">7.4.1</span> Practice exercise 4</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data cleaning and preparation</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="handling-missing-data" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="handling-missing-data"><span class="header-section-number">7.1</span> Handling missing data</h2>
<p>Missing values in a dataset can occur due to several reasons such as breakdown of measuring equipment, accidental removal of observations, lack of response by respondents, error on the part of the researcher, etc.</p>
<p>Let us read the dataset <em>GDP_missing_data.csv</em>, in which we have randomly removed some values, or put missing values in some of the columns.</p>
<p>We’ll also read <em>GDP_complete_data.csv</em>, in which we have not removed any values. We’ll use this data later to assess the accuracy of our guess or estimate of missing values in <em>GDP_missing_data.csv</em>.</p>
<div class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn <span class="im">as</span> sk</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>gdp_missing_values_data <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/GDP_missing_data.csv'</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>gdp_complete_data <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/GDP_complete_data.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>gdp_missing_values_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">economicActivityFemale</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">lifeMale</th>
<th data-quarto-table-cell-role="th">infantMortality</th>
<th data-quarto-table-cell-role="th">gdpPerCapita</th>
<th data-quarto-table-cell-role="th">economicActivityMale</th>
<th data-quarto-table-cell-role="th">illiteracyMale</th>
<th data-quarto-table-cell-role="th">illiteracyFemale</th>
<th data-quarto-table-cell-role="th">lifeFemale</th>
<th data-quarto-table-cell-role="th">geographic_location</th>
<th data-quarto-table-cell-role="th">contraception</th>
<th data-quarto-table-cell-role="th">continent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7.2</td>
<td>Afghanistan</td>
<td>45.0</td>
<td>154.0</td>
<td>2474.0</td>
<td>87.5</td>
<td>NaN</td>
<td>85.0</td>
<td>46.0</td>
<td>Southern Asia</td>
<td>NaN</td>
<td>Asia</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>7.8</td>
<td>Algeria</td>
<td>67.5</td>
<td>44.0</td>
<td>11433.0</td>
<td>76.4</td>
<td>26.1</td>
<td>51.0</td>
<td>70.3</td>
<td>Northern Africa</td>
<td>NaN</td>
<td>Africa</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>41.3</td>
<td>Argentina</td>
<td>69.6</td>
<td>22.0</td>
<td>NaN</td>
<td>76.2</td>
<td>3.8</td>
<td>3.8</td>
<td>76.8</td>
<td>South America</td>
<td>NaN</td>
<td>South America</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>52.0</td>
<td>Armenia</td>
<td>67.2</td>
<td>25.0</td>
<td>13638.0</td>
<td>65.0</td>
<td>NaN</td>
<td>0.5</td>
<td>74.0</td>
<td>Western Asia</td>
<td>NaN</td>
<td>Asia</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>53.8</td>
<td>Australia</td>
<td>NaN</td>
<td>6.0</td>
<td>54891.0</td>
<td>NaN</td>
<td>1.0</td>
<td>1.0</td>
<td>81.2</td>
<td>Oceania</td>
<td>NaN</td>
<td>Oceania</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Observe that the <code>gdp_missing_values_data</code> dataset consists of some missing values shown as NaN (Not a Number).</p>
<section id="identifying-missing-values-isnull" class="level3" data-number="7.1.1">
<h3 data-number="7.1.1" class="anchored" data-anchor-id="identifying-missing-values-isnull"><span class="header-section-number">7.1.1</span> Identifying missing values (<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.isnull.html"><code>isnull()</code></a>)</h3>
<p>Missing values in a Pandas DataFrame can be identified with the <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.isnull.html"><code>isnull()</code></a> method. The Pandas Series object also consists of the <a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.isnull.html"><code>isnull()</code></a> method. For finding the number of missing values in each column of <code>gdp_missing_values_data</code>, we will sum up the missing values in each column of the dataset:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>gdp_missing_values_data.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>economicActivityFemale    10
country                    0
lifeMale                  10
infantMortality           10
gdpPerCapita              10
economicActivityMale      10
illiteracyMale            10
illiteracyFemale          10
lifeFemale                10
geographic_location        0
contraception             71
continent                  0
dtype: int64</code></pre>
</div>
</div>
<p>Note that the descriptive statistics methods associated with Pandas objects ignore missing values by default. Consider the summary statistics of <code>gdp_missing_values_data</code>:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>gdp_missing_values_data.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">economicActivityFemale</th>
<th data-quarto-table-cell-role="th">lifeMale</th>
<th data-quarto-table-cell-role="th">infantMortality</th>
<th data-quarto-table-cell-role="th">gdpPerCapita</th>
<th data-quarto-table-cell-role="th">economicActivityMale</th>
<th data-quarto-table-cell-role="th">illiteracyMale</th>
<th data-quarto-table-cell-role="th">illiteracyFemale</th>
<th data-quarto-table-cell-role="th">lifeFemale</th>
<th data-quarto-table-cell-role="th">contraception</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>145.000000</td>
<td>145.000000</td>
<td>145.000000</td>
<td>145.000000</td>
<td>145.000000</td>
<td>145.000000</td>
<td>145.000000</td>
<td>145.000000</td>
<td>84.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>45.935172</td>
<td>65.491724</td>
<td>37.158621</td>
<td>24193.482759</td>
<td>76.563448</td>
<td>13.570028</td>
<td>21.448897</td>
<td>70.615862</td>
<td>51.773810</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>16.875922</td>
<td>9.099256</td>
<td>34.465699</td>
<td>22748.764444</td>
<td>7.854730</td>
<td>16.497954</td>
<td>25.497045</td>
<td>9.923791</td>
<td>31.930026</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>1.900000</td>
<td>36.000000</td>
<td>3.000000</td>
<td>772.000000</td>
<td>51.200000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>39.100000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>35.500000</td>
<td>62.900000</td>
<td>10.000000</td>
<td>6837.000000</td>
<td>72.000000</td>
<td>1.000000</td>
<td>2.300000</td>
<td>67.500000</td>
<td>17.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>47.600000</td>
<td>67.800000</td>
<td>24.000000</td>
<td>15184.000000</td>
<td>77.300000</td>
<td>6.600000</td>
<td>9.720000</td>
<td>73.900000</td>
<td>65.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>55.900000</td>
<td>72.400000</td>
<td>54.000000</td>
<td>35957.000000</td>
<td>81.600000</td>
<td>19.500000</td>
<td>30.200000</td>
<td>78.100000</td>
<td>77.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>90.600000</td>
<td>77.400000</td>
<td>169.000000</td>
<td>122740.000000</td>
<td>93.000000</td>
<td>70.500000</td>
<td>90.800000</td>
<td>82.900000</td>
<td>79.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Observe that the <code>count</code> statistics report the number of non-missing values of each column in the data, as the number of rows in the data (see code below) is more than the number of non-missing values of all the variables in the above table. Similarly, for the rest of the statistics, such as <code>mean</code>, <code>std</code>, etc., the missing values are ignored.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The dataset gdp_missing_values_data has 155 rows</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>gdp_missing_values_data.shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>155</code></pre>
</div>
</div>
</section>
<section id="types-of-missing-values" class="level3" data-number="7.1.2">
<h3 data-number="7.1.2" class="anchored" data-anchor-id="types-of-missing-values"><span class="header-section-number">7.1.2</span> Types of missing values</h3>
<p>Now that we know how to identify missing values in the dataset, let us learn about the types of missing values that can be there. <span class="citation" data-cites="rubin1976inference">Rubin (<a href="references.html#ref-rubin1976inference" role="doc-biblioref">1976</a>)</span> classified missing values in three categories.</p>
<section id="missing-completely-at-random-mcar" class="level4" data-number="7.1.2.1">
<h4 data-number="7.1.2.1" class="anchored" data-anchor-id="missing-completely-at-random-mcar"><span class="header-section-number">7.1.2.1</span> Missing Completely at Random (MCAR)</h4>
<p>If the probability of being missing is the same for all cases, then the data are said to be missing completely at random. An example of MCAR is a weighing scale that ran out of batteries. Some of the data will be missing simply because of bad luck.</p>
</section>
<section id="missing-at-random-mar" class="level4" data-number="7.1.2.2">
<h4 data-number="7.1.2.2" class="anchored" data-anchor-id="missing-at-random-mar"><span class="header-section-number">7.1.2.2</span> Missing at Random (MAR)</h4>
<p>If the probability of being missing is the same only within groups defined by the observed data, then the data are missing at random (MAR). MAR is a much broader class than MCAR. For example, when placed on a soft surface, a weighing scale may produce more missing values than when placed on a hard surface. Such data are thus not MCAR. If, however, we know surface type and if we can assume MCAR within the type of surface, then the data are MAR</p>
</section>
<section id="missing-not-at-random-mnar" class="level4" data-number="7.1.2.3">
<h4 data-number="7.1.2.3" class="anchored" data-anchor-id="missing-not-at-random-mnar"><span class="header-section-number">7.1.2.3</span> Missing Not at Random (MNAR)</h4>
<p>MNAR means that the probability of being missing varies for reasons that are unknown to us. For example, the weighing scale mechanism may wear out over time, producing more missing data as time progresses, but we may fail to note this. If the heavier objects are measured later in time, then we obtain a distribution of the measurements that will be distorted. MNAR includes the possibility that the scale produces more missing values for the heavier objects (as above), a situation that might be difficult to recognize and handle.</p>
<p><em>Source: https://stefvanbuuren.name/fimd/sec-MCAR.html</em></p>
</section>
</section>
<section id="practice-exercise-1" class="level3" data-number="7.1.3">
<h3 data-number="7.1.3" class="anchored" data-anchor-id="practice-exercise-1"><span class="header-section-number">7.1.3</span> Practice exercise 1</h3>
<section id="section" class="level4" data-number="7.1.3.1">
<h4 data-number="7.1.3.1" class="anchored" data-anchor-id="section"><span class="header-section-number">7.1.3.1</span> </h4>
<p>In which of the above scenarios can we ignore the observations corresponding to missing values without the risk of skewing the analysis/trends in the data?</p>
</section>
<section id="section-1" class="level4" data-number="7.1.3.2">
<h4 data-number="7.1.3.2" class="anchored" data-anchor-id="section-1"><span class="header-section-number">7.1.3.2</span> </h4>
<p>In which of the above scenarios will it be the more risky to impute or estimate missing values?</p>
</section>
<section id="section-2" class="level4" data-number="7.1.3.3">
<h4 data-number="7.1.3.3" class="anchored" data-anchor-id="section-2"><span class="header-section-number">7.1.3.3</span> </h4>
<p>For the datset consisting of GDP per capita, think of hypothetical scenarios in which the missing values of GDP per capita can correspond to MCAR / MAR / MNAR.</p>
</section>
</section>
<section id="dropping-observations-with-missing-values-dropna" class="level3" data-number="7.1.4">
<h3 data-number="7.1.4" class="anchored" data-anchor-id="dropping-observations-with-missing-values-dropna"><span class="header-section-number">7.1.4</span> Dropping observations with missing values (<a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.dropna.html"><code>dropna()</code></a>)</h3>
<p>Sometimes our analysis requires that there should be no missing values in the dataset. For example, while building statistical models, we may require the values of all the predictor variables. The quickest way is to use the <code>dropna()</code> method, which drops the observations that even have a single missing value, and leaves only complete observations in the data.</p>
<p>Let us drop the rows containing even a single value from <code>gdp_missing_values_data</code>.</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>gdp_no_missing_data <span class="op">=</span> gdp_missing_values_data.dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Shape of gdp_no_missing_data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>gdp_no_missing_data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>(42, 12)</code></pre>
</div>
</div>
<p>Dropping rows with even a single missing value has reduced the number of rows from 155 to 42! However, earlier we saw that all the columns except <code>contraception</code> had at most 10 missing values. Removing all rows / columns with even a single missing value results in loss of data that is non-missing in the respective rows/columns. Thus, it is typically a bad idea to drop observations with even a single missing value, except in cases where we have a very small number of missing-value observations.</p>
<p>If a few values of a column are missing, we can possibly estimate them using the rest of the data, so that we can (hopefully) maximize the information that can be extracted from the data. However, if most of the values of a column are missing, it may be harder to estimate its values.</p>
<p>In this case, we see that around 50% values of the <code>contraception</code> column is missing. Thus, we’ll drop the column as it may be hard to impute its values based on a relatively small number of non-missing values.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Deleting column with missing values in almost half of the observations</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>gdp_missing_values_data.drop([<span class="st">'contraception'</span>],axis<span class="op">=</span><span class="dv">1</span>,inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>gdp_missing_values_data.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>(155, 11)</code></pre>
</div>
</div>
</section>
<section id="some-methods-to-impute-missing-values" class="level3" data-number="7.1.5">
<h3 data-number="7.1.5" class="anchored" data-anchor-id="some-methods-to-impute-missing-values"><span class="header-section-number">7.1.5</span> Some methods to impute missing values</h3>
<p>There are an unlimited number of ways to impute missing values. Some imputation methods are provided in the <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/missing_data.html">Pandas documentation</a>.</p>
<p>The best way to impute them will depend on the problem, and the assumptions taken. Below are just a few examples.</p>
<section id="method-1-naive-method" class="level4" data-number="7.1.5.1">
<h4 data-number="7.1.5.1" class="anchored" data-anchor-id="method-1-naive-method"><span class="header-section-number">7.1.5.1</span> Method 1: Naive Method</h4>
<p>Filling the missing value of a column by copying the value of the previous non-missing observation.</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Filling missing values: Method 1- Naive way</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data <span class="op">=</span> gdp_missing_values_data.fillna(method <span class="op">=</span> <span class="st">'ffill'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Checking if any missing values are remaining</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data.isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>economicActivityFemale    0
country                   0
lifeMale                  0
infantMortality           0
gdpPerCapita              0
economicActivityMale      0
illiteracyMale            1
illiteracyFemale          0
lifeFemale                0
geographic_location       0
continent                 0
dtype: int64</code></pre>
</div>
</div>
<p>After imputing missing values, note there is still one missing value for <em>illiteracyMale</em>. Can you guess why one missing value remained?</p>
<p>Let us check how good is this method in imputing missing values. We’ll compare the imputed values of <code>gdpPerCapita</code> with the actual values. Recall that we had randomly put some missing values in <code>gdp_missing_values_data</code>, and we have the actual values in <code>gdp_complete_data</code>.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Index of rows with missing values for GDP per capita</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>null_ind_gdpPC <span class="op">=</span> gdp_missing_values_data.index[gdp_missing_values_data.gdpPerCapita.isnull()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Defining a function to plot the imputed values vs actual values </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_actual_vs_predicted():</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">'xtick'</span>, labelsize<span class="op">=</span><span class="dv">15</span>) </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    plt.rc(<span class="st">'ytick'</span>, labelsize<span class="op">=</span><span class="dv">15</span>) </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> gdp_complete_data.loc[null_ind_gdpPC,<span class="st">'gdpPerCapita'</span>]</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> gdp_imputed_data.loc[null_ind_gdpPC,<span class="st">'gdpPerCapita'</span>]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    plt.scatter(x,y)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    z<span class="op">=</span>np.polyfit(x,y,<span class="dv">1</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    p<span class="op">=</span>np.poly1d(z)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    plt.plot(x,x,color<span class="op">=</span><span class="st">'orange'</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Actual GDP per capita'</span>,fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Imputed GDP per capita'</span>,fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_major_formatter(<span class="st">'${x:,.0f}'</span>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    ax.yaxis.set_major_formatter(<span class="st">'${x:,.0f}'</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    rmse <span class="op">=</span> np.sqrt(((x<span class="op">-</span>y).<span class="bu">pow</span>(<span class="dv">2</span>)).mean())</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"RMSE="</span>,rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot comparing imputed values with actual values, and computing the Root mean square error (RMSE) of the imputed values</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>plot_actual_vs_predicted()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE= 34843.91091137732</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Data cleaning and preparation_files/figure-html/cell-14-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>We observe that the accuracy of imputation is poor as GDP per capita can vary a lot across countries, and the data is not sorted by GDP per capita. There is no reason why the GDP per capita of a country should be close to the GDP per capita of the country in the observation above it.</p>
</section>
<section id="method-2-imputing-missing-values-as-the-mean-of-non-missing-values" class="level4" data-number="7.1.5.2">
<h4 data-number="7.1.5.2" class="anchored" data-anchor-id="method-2-imputing-missing-values-as-the-mean-of-non-missing-values"><span class="header-section-number">7.1.5.2</span> Method 2: Imputing missing values as the mean of non-missing values</h4>
<p>Let us impute missing values in the column as the average of the non-missing values of the column. The sum of squared differences between actual values and the imputed values is likely to be smaller if we impute using the mean. However, this may not be true in cases other than MCAR (Missing completely at random).</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Filling missing values: Method 2</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data <span class="op">=</span> gdp_missing_values_data.fillna(gdp_missing_values_data.mean())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>plot_actual_vs_predicted()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE= 30793.549983587087</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Data cleaning and preparation_files/figure-html/cell-16-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Although this method of imputation doesn’t seem impressive, the RMSE of the estimates is lower than that of the naive method. Since we had introduced missing values randomly in <code>gdp_missing_values_data</code>, the mean GDP per capita will be the closest constant to the GDP per capita values, in terms of squared error.</p>
</section>
<section id="method-3-imputing-missing-values-based-on-correlated-variables-in-the-data" class="level4" data-number="7.1.5.3">
<h4 data-number="7.1.5.3" class="anchored" data-anchor-id="method-3-imputing-missing-values-based-on-correlated-variables-in-the-data"><span class="header-section-number">7.1.5.3</span> Method 3: Imputing missing values based on correlated variables in the data</h4>
<p>If a variable is highly correlated with another variable in the dataset, we can approximate its missing values using the trendline with the highly correlated variable.</p>
<p>Let us visualize the distribution of GDP per capita for different continents.</p>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">"figure.figsize"</span>] <span class="op">=</span> (<span class="dv">12</span>,<span class="dv">6</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x <span class="op">=</span> <span class="st">'continent'</span>,y<span class="op">=</span><span class="st">'gdpPerCapita'</span>,data <span class="op">=</span> gdp_missing_values_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>&lt;AxesSubplot:xlabel='continent', ylabel='gdpPerCapita'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Data cleaning and preparation_files/figure-html/cell-17-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>We observe that there is a distinct difference between the GDPs per capita of some of the contents. Let us impute the missing GDP per capita of a country as the mean GDP per capita of the corresponding continent. This imputation should be better than imputing the missing GDP per capita as the mean of all the non-missing values, as the GDP per capita of a country is likely to be closer to the mean GDP per capita of the continent, rather the mean GDP per capita of the whole world.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Finding the mean GDP per capita of the continent - please defer the understanding of this code to chapter 9.</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>avg_gdpPerCapita <span class="op">=</span> gdp_missing_values_data[<span class="st">'gdpPerCapita'</span>].groupby(gdp_missing_values_data[<span class="st">'continent'</span>]).mean()</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>avg_gdpPerCapita</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>continent
Africa            7638.178571
Asia             25922.750000
Europe           45455.303030
North America    19625.210526
Oceania          15385.857143
South America    15360.909091
Name: gdpPerCapita, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating a copy of missing data to impute missing values</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data <span class="op">=</span> gdp_missing_values_data.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Replacing missing GDP per capita with the mean GDP per capita for the corresponding continent</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cont <span class="kw">in</span> avg_gdpPerCapita.index:</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    gdp_imputed_data.loc[(gdp_imputed_data.continent<span class="op">==</span>cont) <span class="op">&amp;</span> (gdp_imputed_data.gdpPerCapita.isnull()),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'gdpPerCapita'</span>]<span class="op">=</span>avg_gdpPerCapita[cont]</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>plot_actual_vs_predicted()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE= 25473.20645170116</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Data cleaning and preparation_files/figure-html/cell-20-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Note that the imputed values are closer to the actual values, and the RMSE has further reduced as expected.</p>
</section>
<section id="practice-exercise-2" class="level4" data-number="7.1.5.4">
<h4 data-number="7.1.5.4" class="anchored" data-anchor-id="practice-exercise-2"><span class="header-section-number">7.1.5.4</span> Practice exercise 2</h4>
<p>Find the numeric variable most strongly correlated with GDP per capita, and use it to impute its missing values. Find the RMSE of the imputed values.</p>
<p><strong>Solution:</strong></p>
<div class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Let us identify the variable highly correlated with GDP per capita.</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>gdp_missing_values_data.corrwith(gdp_missing_values_data.gdpPerCapita)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="115">
<pre><code>economicActivityFemale    0.078332
lifeMale                  0.579850
infantMortality          -0.572201
gdpPerCapita              1.000000
economicActivityMale     -0.134108
illiteracyMale           -0.479143
illiteracyFemale         -0.448273
lifeFemale                0.615954
contraception             0.057923
dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The variable *lifeFemale* has the strongest correlation with GDP per capita. Let us use it to impute missing values of GDP per capita.</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> gdp_missing_values_data.lifeFemale</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> gdp_missing_values_data.gdpPerCapita</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>idx_non_missing <span class="op">=</span> np.isfinite(x) <span class="op">&amp;</span> np.isfinite(y)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>slope_intercept_trendline <span class="op">=</span> np.polyfit(x[idx_non_missing],y[idx_non_missing],<span class="dv">1</span>)   <span class="co">#Finding the slope and intercept for the trendline</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>compute_y_given_x <span class="op">=</span> np.poly1d(slope_intercept_trendline)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating a copy of missing data to impute missing values</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data <span class="op">=</span> gdp_missing_values_data.copy()</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data.loc[null_ind_gdpPC,<span class="st">'gdpPerCapita'</span>]<span class="op">=</span>compute_y_given_x(gdp_missing_values_data.loc[null_ind_gdpPC,<span class="st">'lifeFemale'</span>])</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>plot_actual_vs_predicted()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE= 25570.361516956993</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Data cleaning and preparation_files/figure-html/cell-22-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="method-4-knn-k-nearest-neighbor" class="level4" data-number="7.1.5.5">
<h4 data-number="7.1.5.5" class="anchored" data-anchor-id="method-4-knn-k-nearest-neighbor"><span class="header-section-number">7.1.5.5</span> Method 4: KNN: K-nearest neighbor</h4>
<p>In this method, we’ll impute the missing value of the variable as the mean value of the <span class="math inline">\(K\)</span>-nearest neighbors having non-missing values for that variable. The neighbors to a data-point are identified based on their Euclidean distance to the point in terms of the standardized values of rest of the variables in the data.</p>
<p>Let’s consider a toy example to understand missing value imputation by KNN. Suppose we have to impute missing values in a toy dataset, named as <code>toy_data</code> having 4 observations and 3 variables.</p>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Toy example - A 4x3 array with missing values</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>nan <span class="op">=</span> np.nan</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>toy_data <span class="op">=</span> np.array([[<span class="dv">1</span>, <span class="dv">2</span>, nan], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">3</span>], [nan, <span class="dv">6</span>, <span class="dv">5</span>], [<span class="dv">8</span>, <span class="dv">8</span>, <span class="dv">7</span>]])</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>toy_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<pre><code>array([[ 1.,  2., nan],
       [ 3.,  4.,  3.],
       [nan,  6.,  5.],
       [ 8.,  8.,  7.]])</code></pre>
</div>
</div>
<p>We’ll use some functions from the <em>sklearn</em> library to perform the KNN imputation. It is much easier to directly use the algorithm from <em>sklearn</em>, instead of coding it from scratch.</p>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Library to compute pair-wise Euclidean distance between all observations in the data</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Library to impute missing values with the KNN algorithm</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> impute</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll use the <em>sklearn</em> function <a href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.pairwise.nan_euclidean_distances.html">nan_euclidean_distances()</a> to compute the Euclidean distance between all pairs of observations in the data.</p>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#This is the distance matrix containing the distance of the ith observation from the jth observation at the (i,j) position in the matrix</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>metrics.pairwise.nan_euclidean_distances(toy_data,toy_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>array([[ 0.        ,  3.46410162,  6.92820323, 11.29158979],
       [ 3.46410162,  0.        ,  3.46410162,  7.54983444],
       [ 6.92820323,  3.46410162,  0.        ,  3.46410162],
       [11.29158979,  7.54983444,  3.46410162,  0.        ]])</code></pre>
</div>
</div>
<p>Note that the size of the above matrix is 4x4. This is because the <span class="math inline">\((i,j)^{th}\)</span> element of the matrix is the distance of the <span class="math inline">\(i^{th}\)</span> observation from the <span class="math inline">\(j^{th}\)</span> observation. The matrix is symmetric because the distance of <span class="math inline">\(i^{th}\)</span> observation to the <span class="math inline">\(j^{th}\)</span> observation is the same as the distance of the <span class="math inline">\(j^{th}\)</span> observation to the <span class="math inline">\(i^{th}\)</span> observation.</p>
<p>We’ll use the <em>sklearn</em> function <a href="https://scikit-learn.org/stable/modules/generated/sklearn.impute.KNNImputer.html">KNNImputer()</a> to impute the missing value of a column in <code>toy_data</code> as the mean of the values of the <span class="math inline">\(K\)</span> nearest neighbors to the observation that have non-missing values for that column.</p>
<p>Let us impute the missing values in <code>toy_data</code> using the values of <span class="math inline">\(K=2\)</span> nearest neighbors from the corresponding observation.</p>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#imputing missing values with 2 nearest neighbors, where the neighbors have equal weights</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Define an object of type KNNImputer</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>imputer <span class="op">=</span> impute.KNNImputer(n_neighbors<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Use the object method 'fit_transform' to impute missing values</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>imputer.fit_transform(toy_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<pre><code>array([[1. , 2. , 4. ],
       [3. , 4. , 3. ],
       [5.5, 6. , 5. ],
       [8. , 8. , 7. ]])</code></pre>
</div>
</div>
<p>The third observation was the closest to the <span class="math inline">\(2nd\)</span> and <span class="math inline">\(4th\)</span> observations based on the Euclidean distance matrix. Thus, the missing value in the <span class="math inline">\(3rd\)</span> row of the <code>toy_data</code> has been imputed as the mean of the values in the <span class="math inline">\(2nd\)</span> and <span class="math inline">\(4th\)</span> observations for the corresponding column. Similarly, the <span class="math inline">\(1st\)</span> observation is the closest to the <span class="math inline">\(2nd\)</span> and <span class="math inline">\(3rd\)</span> observations. Thus the missing value in the <span class="math inline">\(1st\)</span> row of <code>toy_data</code> has been imputed as the mean of the values in the <span class="math inline">\(1st\)</span> and <span class="math inline">\(2nd\)</span> observations for the corresponding column.</p>
<p>Let us use KNN to impute the missing values of <code>gdpPerCapita</code> in <code>gdp_missing_values_data</code>. We’ll use only the numeric columns of the data in imputing the missing values. Also, we’ll ignore <code>contraception</code> as it has a lot of missing values, and thus may not be useful.</p>
<div class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Considering numeric columns in the data to use KNN</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="op">+</span><span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">2</span>,<span class="dv">9</span>))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>num_cols</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="133">
<pre><code>[0, 2, 3, 4, 5, 6, 7, 8]</code></pre>
</div>
</div>
<p>Before computing the pair-wise Euclidean distance of observations, we must standardize the data so that all columns are at the same scale. This will avoid columns with a higher magnitude of values having a higher weight in determining the Euclidean distance. Unless there is a reason to give a higher weight to a column, we assume all columns to have the same weight in the Euclidean distance computation.</p>
<p>We can use the code below to scale the data. However, after imputing the missing values, the data is to be scaled back to the original scale, so that each variable is in the same units as in the original dataset. However, if the code below is used, we’ll lose the orginal scale of each of the columns.</p>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Scaling data to compute equally weighted distances from the 'k' nearest neighbors</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>scaled_data <span class="op">=</span> gdp_missing_values_data.iloc[:,num_cols].<span class="bu">apply</span>(<span class="kw">lambda</span> x:(x<span class="op">-</span>x.<span class="bu">min</span>())<span class="op">/</span>(x.<span class="bu">max</span>()<span class="op">-</span>x.<span class="bu">min</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To alleviate the problem of losing the orignial scale of the data, we’ll use the <a href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html">MinMaxScaler</a> object of the <em>sklearn</em> library. The object will store the original scale of the data, which will help transform the data back to the original scale once the missing values have been imputed in the standardized data.</p>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaling data - using sklearn</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Create an object of type MinMaxScaler</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> sk.preprocessing.MinMaxScaler()</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Use the object method 'fit_transform' to scale the values to a standard uniform distribution</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>scaled_data <span class="op">=</span> pd.DataFrame(scaler.fit_transform(gdp_missing_values_data.iloc[:,num_cols]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Imputing missing values with KNNImputer</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Define an object of type KNNImputer</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>imputer <span class="op">=</span> impute.KNNImputer(n_neighbors<span class="op">=</span><span class="dv">3</span>, weights<span class="op">=</span><span class="st">"uniform"</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Use the object method 'fit_transform' to impute missing values</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>imputed_arr <span class="op">=</span> imputer.fit_transform(scaled_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Scaling back the scaled array to obtain the data at the original scale</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Use the object method 'inverse_transform' to scale back the values to the original scale of the data</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>unscaled_data <span class="op">=</span> scaler.inverse_transform(imputed_arr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Note the method imputes the missing value of all the columns</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">#However, we are interested in imputing the missing values of only the 'gdpPerCapita' column</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data <span class="op">=</span> gdp_missing_values_data.copy()</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>gdp_imputed_data.loc[:,<span class="st">'gdpPerCapita'</span>] <span class="op">=</span> unscaled_data[:,<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualizing the accuracy of missing value imputation with KNN</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>plot_actual_vs_predicted()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE= 16804.195967740387</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Data cleaning and preparation_files/figure-html/cell-33-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Note that the RMSE is the lowest in this method. It is because this method imputes missing values as the average of the values of “similar” observations, which is smarter and more robust than the previous methods.</p>
<p>We chose <span class="math inline">\(K=3\)</span> in the missing value imputation for GDP per capita. However, the value of <span class="math inline">\(K\)</span> is typically chosen using a method known as cross validation. We’ll learn about cross-validation in the next course of the sequence.</p>
</section>
</section>
</section>
<section id="data-binning" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="data-binning"><span class="header-section-number">7.2</span> Data binning</h2>
<p>Data binning is a method to group values of a continuous / categorical variable into bins (or categories). Binning may help with</p>
<ol type="i">
<li>Better intepretation of data<br>
</li>
<li>Making better recommendations<br>
</li>
<li>Smooth data, reduce noise</li>
</ol>
<p>Examples:</p>
<p><strong>Binning to better interpret data</strong></p>
<ol type="1">
<li>The number of flu cases everyday may be binned to seasons such as fall, spring, winter and summer, to understand the effect of season on flu.</li>
</ol>
<p><strong>Binning to make recommendations:</strong></p>
<ol start="2" type="1">
<li><p>A doctor may like to group patient age into bins. Grouping patient ages into categories such as Age &lt;=12, 12&lt;Age&lt;=18, 18&lt;Age&lt;=65, Age&gt;65 may help recommend the kind/doses of covid vaccine a patient needs.</p></li>
<li><p>A credit card company may want to bin customers based on their spend, as “High spenders”, “Medium spenders” and “Low spenders”. Binning will help them design customized marketing campaigns for each bin, thereby increasing customer response (or revenue). On the other hand, they use the same campaign for customers withing the same bin, thus minimizng marketing costs.</p></li>
</ol>
<p><strong>Binning to smooth data, and reduce noise</strong></p>
<ol start="4" type="1">
<li>A sales company may want to bin their total sales to a weekly / monthly / yearly level to reduce the noise in day-to-day sales.</li>
</ol>
<p><strong>Example:</strong> The dataset <em>College.csv</em> contains information about US universities. The description of variables of the dataset can be found on page 54 of this <a href="https://hastie.su.domains/ISLR2/ISLRv2_website.pdf">book</a>. Let’s see if we can apply binning to better interpret the association of instructional expenditure per student (<code>Expend</code>) with graduation rate (<code>Grad.Rate</code>) for US universities, and make recommendations.</p>
<div class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>college <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/College.csv'</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>college.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="122">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">Private</th>
<th data-quarto-table-cell-role="th">Apps</th>
<th data-quarto-table-cell-role="th">Accept</th>
<th data-quarto-table-cell-role="th">Enroll</th>
<th data-quarto-table-cell-role="th">Top10perc</th>
<th data-quarto-table-cell-role="th">Top25perc</th>
<th data-quarto-table-cell-role="th">F.Undergrad</th>
<th data-quarto-table-cell-role="th">P.Undergrad</th>
<th data-quarto-table-cell-role="th">Outstate</th>
<th data-quarto-table-cell-role="th">Room.Board</th>
<th data-quarto-table-cell-role="th">Books</th>
<th data-quarto-table-cell-role="th">Personal</th>
<th data-quarto-table-cell-role="th">PhD</th>
<th data-quarto-table-cell-role="th">Terminal</th>
<th data-quarto-table-cell-role="th">S.F.Ratio</th>
<th data-quarto-table-cell-role="th">perc.alumni</th>
<th data-quarto-table-cell-role="th">Expend</th>
<th data-quarto-table-cell-role="th">Grad.Rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Abilene Christian University</td>
<td>Yes</td>
<td>1660</td>
<td>1232</td>
<td>721</td>
<td>23</td>
<td>52</td>
<td>2885</td>
<td>537</td>
<td>7440</td>
<td>3300</td>
<td>450</td>
<td>2200</td>
<td>70</td>
<td>78</td>
<td>18.1</td>
<td>12</td>
<td>7041</td>
<td>60</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Adelphi University</td>
<td>Yes</td>
<td>2186</td>
<td>1924</td>
<td>512</td>
<td>16</td>
<td>29</td>
<td>2683</td>
<td>1227</td>
<td>12280</td>
<td>6450</td>
<td>750</td>
<td>1500</td>
<td>29</td>
<td>30</td>
<td>12.2</td>
<td>16</td>
<td>10527</td>
<td>56</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Adrian College</td>
<td>Yes</td>
<td>1428</td>
<td>1097</td>
<td>336</td>
<td>22</td>
<td>50</td>
<td>1036</td>
<td>99</td>
<td>11250</td>
<td>3750</td>
<td>400</td>
<td>1165</td>
<td>53</td>
<td>66</td>
<td>12.9</td>
<td>30</td>
<td>8735</td>
<td>54</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Agnes Scott College</td>
<td>Yes</td>
<td>417</td>
<td>349</td>
<td>137</td>
<td>60</td>
<td>89</td>
<td>510</td>
<td>63</td>
<td>12960</td>
<td>5450</td>
<td>450</td>
<td>875</td>
<td>92</td>
<td>97</td>
<td>7.7</td>
<td>37</td>
<td>19016</td>
<td>59</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Alaska Pacific University</td>
<td>Yes</td>
<td>193</td>
<td>146</td>
<td>55</td>
<td>16</td>
<td>44</td>
<td>249</td>
<td>869</td>
<td>7560</td>
<td>4120</td>
<td>800</td>
<td>1500</td>
<td>76</td>
<td>72</td>
<td>11.9</td>
<td>2</td>
<td>10922</td>
<td>15</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>To visualize the association between two numeric variables, we typically make a scatterplot. Let us make a scatterplot of graduation rate with expenditure per student, with a trendline.</p>
<div class="cell" data-execution_count="189">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Let's make a scatterplot of 'Grad.Rate' vs 'Expend' with a trendline, to visualize any trend(s).</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(font_scale<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>sns.regplot(data <span class="op">=</span> college, x <span class="op">=</span> <span class="st">"Expend"</span>, y <span class="op">=</span> <span class="st">"Grad.Rate"</span>,scatter_kws<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"orange"</span>}, line_kws<span class="op">=</span>{<span class="st">"color"</span>: <span class="st">"blue"</span>})</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(<span class="st">'${x:,.0f}'</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Expenditure per student'</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Graduation rate'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="189">
<pre><code>Text(0, 0.5, 'Graduation rate')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Data cleaning and preparation_files/figure-html/cell-35-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>The trendline indicates a positive correlation between <code>Expend</code> and <code>Grad.Rate</code>. However, there seems to be a lot of noise and presence of outliers in the data, which makes it hard to interpret the overall trend.</p>
<p>We’ll bin <code>Expend</code> to see if we can better analyze its association with <code>Grad.Rate</code>. However, let us first visualize the distribution of <code>Expend</code>.</p>
<div class="cell" data-execution_count="190">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualizing the distribution of expend</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>sns.histplot(data <span class="op">=</span> college, x<span class="op">=</span> <span class="st">'Expend'</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(<span class="st">'${x:,.0f}'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Data cleaning and preparation_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The distribution of <code>Extend</code> is right skewed with potentially some extremely high outlying values.</p>
<section id="binning-with-equal-width-bins" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="binning-with-equal-width-bins"><span class="header-section-number">7.2.1</span> Binning with equal width bins</h3>
<p>We’ll use the Pandas function <a href="https://pandas.pydata.org/docs/reference/api/pandas.cut.html">cut()</a> to bin <code>Expend</code>. This function creates bins such that all bins have the same width.</p>
<div class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Using the cut() function in Pandas to bin "Expend"</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>Binned_expend <span class="op">=</span> pd.cut(college[<span class="st">'Expend'</span>],<span class="dv">3</span>,retbins <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>Binned_expend</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="123">
<pre><code>(0      (3132.953, 20868.333]
 1      (3132.953, 20868.333]
 2      (3132.953, 20868.333]
 3      (3132.953, 20868.333]
 4      (3132.953, 20868.333]
                ...          
 772    (3132.953, 20868.333]
 773    (3132.953, 20868.333]
 774    (3132.953, 20868.333]
 775     (38550.667, 56233.0]
 776    (3132.953, 20868.333]
 Name: Expend, Length: 777, dtype: category
 Categories (3, interval[float64]): [(3132.953, 20868.333] &lt; (20868.333, 38550.667] &lt; (38550.667, 56233.0]],
 array([ 3132.953     , 20868.33333333, 38550.66666667, 56233.        ]))</code></pre>
</div>
</div>
<p>The <a href="https://pandas.pydata.org/docs/reference/api/pandas.cut.html">cut()</a> function returns a tuple of length 2. The first element of the tuple are the bins, while the second element is an array containing the cut-off values for the bins.</p>
<div class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(Binned_expend)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="124">
<pre><code>tuple</code></pre>
</div>
</div>
<div class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(Binned_expend)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="125">
<pre><code>2</code></pre>
</div>
</div>
<p>Once the bins are obtained, we’ll add a column in the dataset that indicates the bin for <code>Expend</code>.</p>
<div class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creating a categorical variable to store the level of expenditure on a student</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Expend_bin'</span>] <span class="op">=</span> Binned_expend[<span class="dv">0</span>]</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>college.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="126">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">Private</th>
<th data-quarto-table-cell-role="th">Apps</th>
<th data-quarto-table-cell-role="th">Accept</th>
<th data-quarto-table-cell-role="th">Enroll</th>
<th data-quarto-table-cell-role="th">Top10perc</th>
<th data-quarto-table-cell-role="th">Top25perc</th>
<th data-quarto-table-cell-role="th">F.Undergrad</th>
<th data-quarto-table-cell-role="th">P.Undergrad</th>
<th data-quarto-table-cell-role="th">Outstate</th>
<th data-quarto-table-cell-role="th">Room.Board</th>
<th data-quarto-table-cell-role="th">Books</th>
<th data-quarto-table-cell-role="th">Personal</th>
<th data-quarto-table-cell-role="th">PhD</th>
<th data-quarto-table-cell-role="th">Terminal</th>
<th data-quarto-table-cell-role="th">S.F.Ratio</th>
<th data-quarto-table-cell-role="th">perc.alumni</th>
<th data-quarto-table-cell-role="th">Expend</th>
<th data-quarto-table-cell-role="th">Grad.Rate</th>
<th data-quarto-table-cell-role="th">Expend_bin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Abilene Christian University</td>
<td>Yes</td>
<td>1660</td>
<td>1232</td>
<td>721</td>
<td>23</td>
<td>52</td>
<td>2885</td>
<td>537</td>
<td>7440</td>
<td>3300</td>
<td>450</td>
<td>2200</td>
<td>70</td>
<td>78</td>
<td>18.1</td>
<td>12</td>
<td>7041</td>
<td>60</td>
<td>(3132.953, 20868.333]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Adelphi University</td>
<td>Yes</td>
<td>2186</td>
<td>1924</td>
<td>512</td>
<td>16</td>
<td>29</td>
<td>2683</td>
<td>1227</td>
<td>12280</td>
<td>6450</td>
<td>750</td>
<td>1500</td>
<td>29</td>
<td>30</td>
<td>12.2</td>
<td>16</td>
<td>10527</td>
<td>56</td>
<td>(3132.953, 20868.333]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Adrian College</td>
<td>Yes</td>
<td>1428</td>
<td>1097</td>
<td>336</td>
<td>22</td>
<td>50</td>
<td>1036</td>
<td>99</td>
<td>11250</td>
<td>3750</td>
<td>400</td>
<td>1165</td>
<td>53</td>
<td>66</td>
<td>12.9</td>
<td>30</td>
<td>8735</td>
<td>54</td>
<td>(3132.953, 20868.333]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Agnes Scott College</td>
<td>Yes</td>
<td>417</td>
<td>349</td>
<td>137</td>
<td>60</td>
<td>89</td>
<td>510</td>
<td>63</td>
<td>12960</td>
<td>5450</td>
<td>450</td>
<td>875</td>
<td>92</td>
<td>97</td>
<td>7.7</td>
<td>37</td>
<td>19016</td>
<td>59</td>
<td>(3132.953, 20868.333]</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Alaska Pacific University</td>
<td>Yes</td>
<td>193</td>
<td>146</td>
<td>55</td>
<td>16</td>
<td>44</td>
<td>249</td>
<td>869</td>
<td>7560</td>
<td>4120</td>
<td>800</td>
<td>1500</td>
<td>76</td>
<td>72</td>
<td>11.9</td>
<td>2</td>
<td>10922</td>
<td>15</td>
<td>(3132.953, 20868.333]</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>See the variable <code>Expend_bin</code> in the above dataset.</p>
<p>Let us visualize the <code>Expend</code> bins over the distribution of the <code>Expend</code> variable.</p>
<div class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualizing the bins for instructional expediture on a student</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(font_scale<span class="op">=</span><span class="fl">1.25</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">"figure.figsize"</span>] <span class="op">=</span> (<span class="dv">9</span>,<span class="dv">6</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>sns.histplot(data <span class="op">=</span> college, x<span class="op">=</span> <span class="st">'Expend'</span>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>plt.vlines(Binned_expend[<span class="dv">1</span>], <span class="dv">0</span>,<span class="dv">100</span>,color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Expenditure per student'</span>)<span class="op">;</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Graduation rate'</span>)<span class="op">;</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(<span class="st">'${x:,.0f}'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Data cleaning and preparation_files/figure-html/cell-41-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>By default, the bins created have equal width. They are created by dividing the range between the maximum and minimum value of <code>Expend</code> into the desired number of equal-width intervals. We can label the bins as well as follows.</p>
<div class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Expend_bin'</span>] <span class="op">=</span> pd.cut(college[<span class="st">'Expend'</span>],<span class="dv">3</span>,labels <span class="op">=</span> [<span class="st">'Low expend'</span>,<span class="st">'Med expend'</span>,<span class="st">'High expend'</span>])</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Expend_bin'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="128">
<pre><code>0       Low expend
1       Low expend
2       Low expend
3       Low expend
4       Low expend
          ...     
772     Low expend
773     Low expend
774     Low expend
775    High expend
776     Low expend
Name: Expend_bin, Length: 777, dtype: category
Categories (3, object): ['Low expend' &lt; 'Med expend' &lt; 'High expend']</code></pre>
</div>
</div>
<p>Now that we have binned the variable <code>Expend</code>, let us see if we can better visualize the association of graduation rate with expenditure per student using <code>Expened_bin</code>.</p>
<div class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualizing average graduation rate vs categories of instructional expenditure per student</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>sns.barplot(x <span class="op">=</span> <span class="st">'Expend_bin'</span>, y <span class="op">=</span> <span class="st">'Grad.Rate'</span>, data <span class="op">=</span> college)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="129">
<pre><code>&lt;AxesSubplot:xlabel='Expend_bin', ylabel='Grad.Rate'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Data cleaning and preparation_files/figure-html/cell-43-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>It seems that the graduation rate is the highest for universities with medium level of expenditure per student. This is different from the trend we saw earlier in the scatter plot. Let us investigate.</p>
<p>Let us find the number of universities in each bin.</p>
<div class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>pd.value_counts(college[<span class="st">'Expend_bin'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="130">
<pre><code>Low expend     751
Med expend      21
High expend      5
Name: Expend_bin, dtype: int64</code></pre>
</div>
</div>
<p>The bin <code>High expend</code> consists of only 5 universities, or 0.6% of all the universities in the dataset. These universities may be outliers that are skewing the trend (as also evident in the histogram above).</p>
<p>In such cases, we should bin observations such that all bins are of equal size, i.e., they have the same number of observations.</p>
</section>
<section id="binning-with-equal-sized-bins" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="binning-with-equal-sized-bins"><span class="header-section-number">7.2.2</span> Binning with equal sized bins</h3>
<p>Let us bin the variable <code>Expend</code> such that each bin consists of the same number of observations.</p>
<p>We’ll use the Pandas function <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.qcut.html">qcut()</a> to make equal-sized bins (in contrast to equal-width bins in the previous section).</p>
<div class="cell" data-execution_count="131">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Using the Pandas function qcut() to create bins with the same number of observations</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>Binned_expend <span class="op">=</span> pd.qcut(college[<span class="st">'Expend'</span>],<span class="dv">3</span>,retbins <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Expend_bin'</span>] <span class="op">=</span> Binned_expend[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each bin has the same number of observations with <code>qcut()</code>:</p>
<div class="cell" data-execution_count="132">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>pd.value_counts(college[<span class="st">'Expend_bin'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="132">
<pre><code>(3185.999, 7334.333]    259
(7334.333, 9682.333]    259
(9682.333, 56233.0]     259
Name: Expend_bin, dtype: int64</code></pre>
</div>
</div>
<p>Let us visualize the <code>Expend</code> bins over the distribution of the <code>Expend</code> variable.</p>
<div class="cell" data-execution_count="133">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualizing the bins for instructional expediture on a student</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(font_scale<span class="op">=</span><span class="fl">1.25</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">"figure.figsize"</span>] <span class="op">=</span> (<span class="dv">9</span>,<span class="dv">6</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>sns.histplot(data <span class="op">=</span> college, x<span class="op">=</span> <span class="st">'Expend'</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>plt.vlines(Binned_expend[<span class="dv">1</span>], <span class="dv">0</span>,<span class="dv">100</span>,color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Expenditure per student'</span>)<span class="op">;</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Graduation rate'</span>)<span class="op">;</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(<span class="st">'${x:,.0f}'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Data cleaning and preparation_files/figure-html/cell-47-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Note that the bin-widths have been adjusted to have the same number of observations in each bin. The bins are narrower in domains of high density, and wider in domains of sparse density.</p>
<p>Let us again make the barplot visualizing the average graduate rate with level of instructional expenditure per student.</p>
<div class="cell" data-execution_count="134">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Expend_bin'</span>] <span class="op">=</span> pd.qcut(college[<span class="st">'Expend'</span>],<span class="dv">3</span>,labels <span class="op">=</span> [<span class="st">'Low expend'</span>,<span class="st">'Med expend'</span>,<span class="st">'High expend'</span>])</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>a<span class="op">=</span>sns.barplot(x <span class="op">=</span> <span class="st">'Expend_bin'</span>, y <span class="op">=</span> <span class="st">'Grad.Rate'</span>, data <span class="op">=</span> college)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Data cleaning and preparation_files/figure-html/cell-48-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Now we see the same trend that we saw in the scatterplot, but without the noise. We have smoothed the data. Note that making equal-sized bins helps reduce the effect of outliers in the overall trend.</p>
<p>Suppose this analysis was done to provide recommendations to universities for increasing their graduation rate. With binning, we can can provide one recommendation to <em>‘Low expend’</em> universities, and another one to <em>‘Med expend’</em> universities. For example, the recommendations can be:</p>
<ol type="1">
<li><em>‘Low expend’</em> universities can expect an increase of 9 percentage points in <code>Grad.Rate</code>, if they migrate to the <em>‘Med expend’</em> category.</li>
<li><em>‘Med expend’</em> universities can expect an increase of 7 percentage points in <code>Grad.Rate</code>, if they migrate to the <em>‘High expend’</em> category.</li>
</ol>
<p>The numbers in the above recommendations are based on the table below.</p>
<div class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Grad.Rate'</span>].groupby(college.Expend_bin).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="135">
<pre><code>Expend_bin
Low expend     57.343629
Med expend     66.057915
High expend    72.988417
Name: Grad.Rate, dtype: float64</code></pre>
</div>
</div>
<p>We can also make recommendations based on the confidence intervals of mean Grad.Rate. Confidence intervals are computed below. We are finding confidence intervals based on a method known as bootstrapping. Refer https://en.wikipedia.org/wiki/Bootstrapping_(statistics) for a detailed description of Bootstrapping.</p>
<div class="cell" data-execution_count="136">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Bootstrapping to find 95% confidence intervals of Graduation Rate of US universities based on average expenditure per student</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> expend_bin <span class="kw">in</span> college.Expend_bin.unique():</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    data_sub <span class="op">=</span> college.loc[college.Expend_bin<span class="op">==</span>expend_bin,:]</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    samples <span class="op">=</span> np.random.choice(data_sub[<span class="st">'Grad.Rate'</span>], size<span class="op">=</span>(<span class="dv">10000</span>,data_sub.shape[<span class="dv">0</span>]))</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"95% Confidence interval of Grad.Rate for "</span><span class="op">+</span>expend_bin<span class="op">+</span><span class="st">" univeristies = ["</span><span class="op">+</span><span class="bu">str</span>(np.<span class="bu">round</span>(np.percentile(samples.mean(axis<span class="op">=</span><span class="dv">1</span>),<span class="fl">2.5</span>),<span class="dv">2</span>))<span class="op">+</span><span class="st">","</span><span class="op">+</span><span class="bu">str</span>(np.<span class="bu">round</span>(np.percentile(samples.mean(axis<span class="op">=</span><span class="dv">1</span>),<span class="fl">97.5</span>),<span class="dv">2</span>))<span class="op">+</span><span class="st">"]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>95% Confidence interval of Grad.Rate for Low expend univeristies = [55.34,59.34]
95% Confidence interval of Grad.Rate for High expend univeristies = [71.01,74.92]
95% Confidence interval of Grad.Rate for Med expend univeristies = [64.22,67.93]</code></pre>
</div>
</div>
<p>Apart from equal-width and equal-sized bins, custom bins can be created using the <em>bins</em> argument. Suppose, bins are to be created for <code>Expend</code> with cutoffs <span class="math inline">\(\$10,000, \$20,000, \$30,000... \$60,000\)</span>. Then, we can use the <em>bins</em> argument as in the code below:</p>
</section>
<section id="binning-with-custom-bins" class="level3" data-number="7.2.3">
<h3 data-number="7.2.3" class="anchored" data-anchor-id="binning-with-custom-bins"><span class="header-section-number">7.2.3</span> Binning with custom bins</h3>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>Binned_expend <span class="op">=</span> pd.cut(college.Expend,bins <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">70000</span>,<span class="dv">10000</span>)),retbins<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Visualizing the bins for instructional expediture on a student</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>sns.histplot(data <span class="op">=</span> college, x<span class="op">=</span> <span class="st">'Expend'</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>plt.vlines(Binned_expend[<span class="dv">1</span>], <span class="dv">0</span>,<span class="dv">100</span>,color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Expenditure per student'</span>)<span class="op">;</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Graduation rate'</span>)<span class="op">;</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(<span class="st">'${x:,.0f}'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Data cleaning and preparation_files/figure-html/cell-52-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>As custom bin-cutoffs can be specified with the <code>cut()</code> function, custom bin quantiles can be specified with the <code>qcut()</code> function.</p>
</section>
</section>
<section id="dummy-indicator-variables" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="dummy-indicator-variables"><span class="header-section-number">7.3</span> Dummy / Indicator variables</h2>
<p>Dummy variables (or indicator variables) take only the values of 0 and 1 to indicate the presence or absence of a catagorical effect. They are particularly useful in regression modeling to help explain the dependent variable.</p>
<p>If a column in a DataFrame has <span class="math inline">\(k\)</span> distinct values, we will get a DataFrame with <span class="math inline">\(k\)</span> columns containing 0s and 1s with the Pandas <a href="https://pandas.pydata.org/docs/reference/api/pandas.get_dummies.html"><code>get_dummies()</code></a> function.</p>
<p>Let us make dummy variables with the equal-sized bins we created for the average instruction expenditure per student.</p>
<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Using the Pandas function qcut() to create bins with the same number of observations</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>Binned_expend <span class="op">=</span> pd.qcut(college[<span class="st">'Expend'</span>],<span class="dv">3</span>,retbins <span class="op">=</span> <span class="va">True</span>,labels <span class="op">=</span> [<span class="st">'Low_expend'</span>,<span class="st">'Med_expend'</span>,<span class="st">'High_expend'</span>])</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>college[<span class="st">'Expend_bin'</span>] <span class="op">=</span> Binned_expend[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Making dummy variables based on the levels (categories) of the 'Expend_bin' variable</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>dummy_Expend <span class="op">=</span> pd.get_dummies(college[<span class="st">'Expend_bin'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The dummy data <code>dummy_Expend</code> has a value of <span class="math inline">\(1\)</span> if the observation corresponds to the category referenced by the column name.</p>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>dummy_Expend.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="98">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Low_expend</th>
<th data-quarto-table-cell-role="th">Med_expend</th>
<th data-quarto-table-cell-role="th">High_expend</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can find the correlation between the dummy variables and graduation rate to identify if any of the dummy variables will be useful to estimate graduation rate (<code>Grad.Rate</code>).</p>
<div class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Finding if dummy variables will be useful to estimate 'Grad.Rate'</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>dummy_Expend.corrwith(college[<span class="st">'Grad.Rate'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="114">
<pre><code>Low_expend    -0.334456
Med_expend     0.024492
High_expend    0.309964
dtype: float64</code></pre>
</div>
</div>
<p>The dummy variables <code>Low expend</code> and <code>High expend</code> may contribute in explaining <code>Grad.Rate</code> in a regression model.</p>
<section id="practice-exercise-3" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="practice-exercise-3"><span class="header-section-number">7.3.1</span> Practice exercise 3</h3>
<p>Read <em>survey_data_clean.csv</em>. Split the columns of the dataset, such that all columns with categorical values transform into dummy variables with each category corresponding to a column of 0s and 1s. Leave the <em>Timestamp</em> column.</p>
<p>As all categorical columns are transformed to dummy variables, all columns have numeric values.</p>
<p>What is the total number of columns in the transformed data? What is the total number of columns of the original data?</p>
<p>Find the:</p>
<ol type="1">
<li><p>Top 5 variables having the highest positive correlation with <code>NU_GPA</code>.</p></li>
<li><p>Top 5 variables having the highest negative correlation with <code>NU_GPA</code>.</p></li>
</ol>
<p><strong>Solution:</strong></p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>survey_data <span class="op">=</span> pd.read_csv(<span class="st">'./Datasets/survey_data_clean.csv'</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>survey_dummies<span class="op">=</span>pd.get_dummies(survey_data.iloc[:,<span class="dv">1</span>:])</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The total number of columns in the transformed data are"</span>, survey_dummies.shape[<span class="dv">1</span>])</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The total number of columns in the original data are"</span>, survey_dummies.shape[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The total number of columns in the transformed data are 308
The total number of columns in the original data are 192</code></pre>
</div>
</div>
<p>Below are the top 5 variables having the highest positive correlation with <code>NU_GPA</code>:</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>survey_dummies.corrwith(survey_dummies.NU_GPA).drop(index <span class="op">=</span> <span class="st">'NU_GPA'</span>).sort_values(ascending<span class="op">=</span><span class="va">False</span>)[<span class="dv">0</span>:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>fav_letter_o                                                                              0.367140
fav_sport_Dance!                                                                          0.367140
major_Humanities / Communications;Physical Sciences / Natural Sciences / Engineering      0.271019
fav_alcohol_I don't drink                                                                 0.213118
learning_style_Reading/Writing (learn best through words often note-taking or reading)    0.207451
dtype: float64</code></pre>
</div>
</div>
<p>Below are the top 5 variables having the highest negative correlation with <code>NU_GPA</code>:</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>survey_dummies.corrwith(survey_dummies.NU_GPA).drop(index <span class="op">=</span> <span class="st">'NU_GPA'</span>).sort_values(ascending<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>fav_number                                         -0.307656
procrastinator                                     -0.269552
fav_sport_Underwater Basketweaving                 -0.224237
birth_month_February                               -0.222141
streaming_platforms_Netflix;Amazon Prime;HBO Max   -0.221099
dtype: float64</code></pre>
</div>
</div>
</section>
</section>
<section id="outlier-detection" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="outlier-detection"><span class="header-section-number">7.4</span> Outlier detection</h2>
<p>An outlier is an observation that is significantly different from the rest of the data. Detection of outliers is important as they may distort the general trends in data.</p>
<p>Let us visualize outliers in average instructional expenditure per student given by the variable <code>Expend</code>.</p>
<div class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>college.boxplot(column <span class="op">=</span> <span class="st">'Expend'</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>ax.yaxis.set_major_formatter(<span class="st">'${x:,.0f}'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Data cleaning and preparation_files/figure-html/cell-60-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>There are several outliers (shown as circles in the above boxplot), which correspond to high values of average instructional expenditure per student. Boxplot identifies outliers based on the <a href="https://en.wikipedia.org/wiki/Outlier">Tukey’s fences</a> criterion:</p>
<p><strong>Tukey’s fences:</strong> John Tukey proposed that observations outside the range <span class="math inline">\([Q1 - 1.5(Q3-Q1), Q3+1.5(Q3-Q1)]\)</span> are outliers, where <span class="math inline">\(Q1\)</span> and <span class="math inline">\(Q3\)</span> are the lower <span class="math inline">\((25\%)\)</span> and upper <span class="math inline">\((75\%)\)</span> quartiles respectively. Let us detect outliers based on Tukey’s fences.</p>
<div class="cell" data-execution_count="137">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Finding upper and lower quartiles and interquartile range</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>q1 <span class="op">=</span> np.percentile(college[<span class="st">'Expend'</span>],<span class="dv">25</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>q3 <span class="op">=</span> np.percentile(college[<span class="st">'Expend'</span>],<span class="dv">75</span>)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>intQ_range <span class="op">=</span> q3<span class="op">-</span>q1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="138">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tukey's fences</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>Lower_fence <span class="op">=</span> q1 <span class="op">-</span> <span class="fl">1.5</span><span class="op">*</span>intQ_range</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>Upper_fence <span class="op">=</span> q3 <span class="op">+</span> <span class="fl">1.5</span><span class="op">*</span>intQ_range</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">#These are the outlying observations - those outside of Tukey's fences</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>Outlying_obs <span class="op">=</span> college[(college.Expend<span class="op">&lt;</span>Lower_fence) <span class="op">|</span> (college.Expend<span class="op">&gt;</span>Upper_fence)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="140">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Data without outliers</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>college_data_without_outliers <span class="op">=</span> college[((college.Expend<span class="op">&gt;=</span>Lower_fence) <span class="op">&amp;</span> (college.Expend<span class="op">&lt;=</span>Upper_fence))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Earlier, the trend was distorted by outliers when we created bins of equal width. Let us see if we get the correct trend with the outliers removed from the data.</p>
<div class="cell" data-execution_count="144">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>Binned_data <span class="op">=</span> pd.cut(college_data_without_outliers[<span class="st">'Expend'</span>],<span class="dv">3</span>,labels <span class="op">=</span> [<span class="st">'Low expend'</span>,<span class="st">'Med expend'</span>,<span class="st">'High expend'</span>],retbins <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>college_data_without_outliers.loc[:,<span class="st">'Expend_bin'</span>] <span class="op">=</span> Binned_data[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="146">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>sns.barplot(x <span class="op">=</span> <span class="st">'Expend_bin'</span>, y <span class="op">=</span> <span class="st">'Grad.Rate'</span>, data <span class="op">=</span> college_data_without_outliers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="146">
<pre><code>&lt;AxesSubplot:xlabel='Expend_bin', ylabel='Grad.Rate'&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Data cleaning and preparation_files/figure-html/cell-66-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>With the outliers removed, we obtain the correct overall trend, even in the case of equal-width bins. Note that these bins have unequal number of observations as shown below.</p>
<div class="cell" data-execution_count="151">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>(font_scale<span class="op">=</span><span class="fl">1.35</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>ax<span class="op">=</span>sns.histplot(data <span class="op">=</span> college_data_without_outliers, x<span class="op">=</span> <span class="st">'Expend'</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>):</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>    plt.axvline(Binned_data[<span class="dv">1</span>][i], <span class="dv">0</span>,<span class="dv">100</span>,color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Expenditure per student'</span>)<span class="op">;</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Graduation rate'</span>)<span class="op">;</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(<span class="st">'${x:,.0f}'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Data cleaning and preparation_files/figure-html/cell-67-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Note that the right tail of the histogram has disappered since we removed outliers.</p>
<div class="cell" data-execution_count="152">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>college_data_without_outliers[<span class="st">'Expend_bin'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="152">
<pre><code>Med expend     327
Low expend     314
High expend     88
Name: Expend_bin, dtype: int64</code></pre>
</div>
</div>
<section id="practice-exercise-4" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="practice-exercise-4"><span class="header-section-number">7.4.1</span> Practice exercise 4</h3>
<p>Consider the dataset created for <em>survey_data_clean.csv</em> in <a href="https://nustat.github.io/DataScience_Intro_python/Data%20cleaning%20and%20preparation.html#practice-exercise-3">Practice exercise 3</a>, which includes dummy variables for all the categorical variables. Find the number of outliers in each column of the dataset based on the Tukey’s fences criterion. Do not use a <code>for</code> loop.</p>
<p>Which column(s) have the maximum number of outliers?</p>
<p>Do you think the outlying observations identified with the Tukey’s fences criterion for those columns(s) should be considered as outliers? If not, then which type of columns should be considered when finding outliers?</p>
<p><strong>Solution:</strong></p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Function to identify outliers based on Tukey's fences</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rem_outliers(x):</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    q1 <span class="op">=</span>x.quantile(<span class="fl">0.25</span>)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    q3 <span class="op">=</span> x.quantile(<span class="fl">0.75</span>)</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>    intQ_range <span class="op">=</span> q3<span class="op">-</span>q1</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Tukey's fences</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    Lower_fence <span class="op">=</span> q1 <span class="op">-</span> <span class="fl">1.5</span><span class="op">*</span>intQ_range</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>    Upper_fence <span class="op">=</span> q3 <span class="op">+</span> <span class="fl">1.5</span><span class="op">*</span>intQ_range</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#The object returned will be a data frame with bool values - True or False. 'True' will indicate that the value is an outlier</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ((x<span class="op">&lt;</span>Lower_fence) <span class="op">|</span> (x<span class="op">&gt;</span>Upper_fence))</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>survey_dummies.<span class="bu">apply</span>(rem_outliers).<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>learning_style_Reading/Writing (learn best through words often note-taking or reading)    48
much_effort_is_lack_of_talent                                                             48
left_right_brained_Left-brained (logic, science, critical thinking, numbers)              47
left_right_brained_Right-brained (creative, art, imaginative, intuitive)                  47
fav_season_Spring                                                                         47
                                                                                          ..
love_first_sight                                                                           0
birthdate_odd_even_Odd                                                                     0
procrastinator                                                                             0
birthdate_odd_even_Even                                                                    0
how_happy_Pretty happy                                                                     0
Length: 308, dtype: int64</code></pre>
</div>
</div>
<p>Using Tukey’s criterion, the variables <code>learning_style_Reading/Writing (learn best through words often note-taking or reading)</code> and <code>much_effort_is_lack_of_talent</code> have the most number of outliers.</p>
<p>However, these two variables only have 0s and 1s. For instance, let us consider <code>learning_style_Reading/Writing (learn best through words often note-taking or reading)</code>.</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>survey_dummies[<span class="st">'learning_style_Reading/Writing (learn best through words often note-taking or reading)'</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>0    144
1     48
Name: learning_style_Reading/Writing (learn best through words often note-taking or reading), dtype: int64</code></pre>
</div>
</div>
<p>As the percentage of 1s are <span class="math inline">\(\frac{48}{48+144}=25\%\)</span>, the <span class="math inline">\(75^{th}\)</span> percentile value is 0.25, and the upper Tukey’s fence is <span class="math inline">\(0.25+0.25*1.25 = 0.625\)</span>, which makes the value <span class="math inline">\(1\)</span> an outlier. However, we should not consider this value as an outlier, as a considerable fraction of the data (25%) has the value <span class="math inline">\(1\)</span> for this variable.</p>
<p>Furthermore, Tukey’s fences are developed for continuous variables. However, the variable <code>learning_style_Reading/Writing (learn best through words often note-taking or reading)</code> is discrete with only two levels. Thus, while finding outliers we must consider only continuous variables.</p>
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Finding continuous variables: Assuming numeric variables that have more than 2 distinct values are continuous</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>continuous_variables <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">list</span>(survey_data.<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.name <span class="cf">if</span> ((<span class="bu">len</span>(x.value_counts())<span class="op">&gt;</span><span class="dv">2</span>) <span class="op">&amp;</span> (x.dtype<span class="op">!=</span><span class="st">'O'</span>)) <span class="cf">else</span> <span class="st">''</span>)) <span class="cf">if</span> x<span class="op">!=</span><span class="st">''</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Finding number of outliers for only continuous variables</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>survey_data.loc[:,continuous_variables].<span class="bu">apply</span>(rem_outliers).<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="107">
<pre><code>num_clubs                      22
fav_number                     19
parties_per_month              12
internet_hours_per_day         11
sleep_hours_per_day            10
expected_marriage_age          10
expected_starting_salary        8
high_school_GPA                 8
height_mother                   7
num_insta_followers             6
height_father                   6
NU_GPA                          5
minutes_ex_per_week             4
height                          3
farthest_distance_travelled     2
age                             1
num_majors_minors               0
dtype: int64</code></pre>
</div>
</div>
<p>The variable <code>num_clubs</code> has the maximum number of outliers.</p>
<div class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Finding how many clubs makes a person an outlier</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>q3_num_clubs <span class="op">=</span> survey_data.num_clubs.quantile(<span class="fl">0.75</span>)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>q1_num_clubs <span class="op">=</span> survey_data.num_clubs.quantile(<span class="fl">0.25</span>)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Tukeys fences = ["</span>,q1_num_clubs<span class="op">-</span><span class="fl">1.5</span><span class="op">*</span>(q3_num_clubs<span class="op">-</span>q1_num_clubs),q3_num_clubs<span class="op">+</span><span class="fl">1.5</span><span class="op">*</span>(q3_num_clubs<span class="op">-</span>q1_num_clubs),<span class="st">"]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tukeys fences = [ 0.5 4.5 ]</code></pre>
</div>
</div>
<p>People joining no club, or more than 4 clubs are outliers.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-rubin1976inference" class="csl-entry" role="listitem">
Rubin, Donald B. 1976. <span>“Inference and Missing Data.”</span> <em>Biometrika</em> 63 (3): 581–92.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Data visualization.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data visualization</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Data wrangling.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data wrangling</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>